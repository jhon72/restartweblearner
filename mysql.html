<!DOCTYPE html>
    <html>
        <head>
            <title>ResWebLearn72</title>
                <meta charset="utf-8">
                <link rel="stylesheet" href="css/navbar.css">
                <link rel="stylesheet" href="css/footer.css">
                <link rel="stylesheet" href="css/content.css">
                <link rel="stylesheet" href="css/other.css">
                <link href='https://fonts.googleapis.com/css?family=Roboto:500,900,100,300,700,400' rel='stylesheet' type='text/css'>
                <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
                <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
                <script src="main.js"></script>
            <style>body{background: url(img/fon.png);}</style>
        <nav class="blend">
       <ul>
     <div class="hdr">
	   <span>R</span><span>e</span><span>s</span><span>W</span><span>e</span><span>b</span> <div><span>L</span><span>e</span><span>a</span><span>r</span><span>n</span><span>7</span><span>2</span></div></div><br>
      <li><a href="index.html">Главная</a></li>
      <li><a href="openserver.html">OS Panel</a></li>
      <li><a href="htmlandcss.html">HTML5 & CSS3</a></li>
      <li><a href="bootstrap.html">Bootstrap</a></li>   
      <li><a href="javascript.html">JavaScript</a></li>
      <li><a href="ajax.html">AJAX</a></li>
      <li><a href="jquery.html">Jquery Framework</a></li>
      <li><a href="angular.html">Angular Framework</a></li>
      <li><a class="active" href="mysql.html">MySQL</a></li>
      <li><a href="php.html">PHP</a></li>
      <li><a href="phpframework.html">Yii2 Framework</a></li>
      <li><a href="cms.html">CMS</a></li>
      <li><a href="crm.html">CRM</a></li>
      <li><a href="host.html">HOST</a></li>
      <li><a href="contacts.html">О нас</a></li></ul></nav><br><br><br><br><br><br><br><br><br><br><br><br><body>
       <div class="container">
      <div class="bubble">
                        <div class="info">
                        
                        <h1>Базы данных: основные понятия</h1>
<br /><a name="p71139-1"></a>
<!--notypo--><fieldset><legend><strong> Оглавление документа   </strong></legend><div class="toc1"><a href="#h177-2">1. Ключи</a></div><div class="toc1"><a href="#h177-3">2. Индексирование</a></div><div class="toc1"><a href="#h177-4">3. СУБД Mysql</a></div><div class="toc1"><a href="#h177-5">4. Язык SQL</a></div><div class="toc1"><a href="#h177-6">5. Основные операторы языка SQL</a></div><div class="toc1"><a href="#h177-7">6. Описание данных MySQL</a></div><div class="toc1"><a href="#h177-8">7. Построение интерфейса для&nbsp;добавления информации</a></div><div class="toc1"><a href="#h177-9">8. Установка соединения</a></div><div class="toc1"><a href="#h177-10">9. Выбор базы данных</a></div><div class="toc1"><a href="#h177-11">10. Получение списка полей таблицы</a></div><div class="toc2"><a href="#h177-12">10.1. Синтаксис Mysql_list_fields</a></div><div class="toc1"><a href="#h177-13">11. Запись данных в&nbsp;базу данных</a></div><div class="toc2"><a href="#h177-14">11.1. Синтаксис Mysql_query</a></div><div class="toc1"><a href="#h177-15">12. Отображение данных, хранящихся в&nbsp;Mysql</a></div><div class="toc1"><a href="#h177-16">13. Доступ к&nbsp;MySQL</a></div><div class="toc1"><a href="#h177-17">14. Безопасное взаимодействие My&nbsp;SQL и&nbsp;PHP</a></div><div class="toc1"></div></fieldset><!--/notypo--><br /><br /><a name="p71139-2"></a>
В&nbsp;жизни мы&nbsp;часто сталкиваемся с&nbsp;необходимостью хранить какую-либо информацию, а&nbsp;потому часто имеем дело и&nbsp;с базами данных.<br /><br /><a name="p71139-3"></a>
Например, мы&nbsp;используем записную книжку для&nbsp;хранения номеров телефонов своих друзей и&nbsp;планирования своего времени. Телефонная книга содержит информацию о&nbsp;людях, живущих в&nbsp;одном городе. Все&nbsp;это своего рода базы данных. Ну&nbsp;а раз&nbsp;это базы данных, то&nbsp;посмотрим, как&nbsp;в&nbsp;них хранятся данные. Например, телефонная книга представляет собой таблицу (табл. 10.1).<br /><br /><a name="p71139-4"></a>
В&nbsp;этой таблице данные – это&nbsp;собственно номера телефонов, адреса и&nbsp;ФИО., т.е. строки «Иванов Иван Иванович», «<span class="nobr">32&ndash;43&ndash;12</span>» и&nbsp;т.п., а&nbsp;названия столбцов этой таблицы, т.е. строки «ФИО», «Номер телефона» и&nbsp;«Адрес» задают смысл этих данных, их&nbsp;семантику.<br /><br /><a name="p71139-5"></a>
Таблица 10.1. Пример базы данных: телефонная книга<br /><br />
<table class="usertable" border="1">
<tr class="userrow"><td class="usercell"><strong>ФИО</strong></td><td class="usercell"> <strong>Номер телефона</strong> </td><td  class="usercell"><strong>Адрес</strong></td></tr>
<tr class="userrow"><td class="usercell">Иванов Иван Иванович</td><td class="usercell"> <span class="nobr">32&ndash;43&ndash;12</span></td><td  class="usercell"> ул.&nbsp;Ленина, 12, 43</td></tr>
<tr class="userrow"><td class="usercell">Ильин Федор Иванович</td><td class="usercell"> <span class="nobr">32&ndash;32&ndash;34</span></td><td  class="usercell"> пр. Маркса, 32, 45</td></tr>
</table>
<br /><a name="p71139-6"></a>
Теперь представьте, что&nbsp;записей в&nbsp;этой таблице не&nbsp;две, а&nbsp;две тысячи, вы&nbsp;занимаетесь созданием этого справочника и&nbsp;где-то произошла ошибка (например, опечатка в&nbsp;адресе). Видимо, тяжеловато будет найти и&nbsp;исправить эту&nbsp;ошибку вручную. Нужно воспользоваться какими-то средствами автоматизации. Для&nbsp;управления большим количеством данных программисты (не без&nbsp;помощи математиков) придумали системы управления базами данных (СУБД). По&nbsp;сравнению с&nbsp;текстовыми базами данных электронные СУБД имеют огромное число преимуществ, от&nbsp;возможности быстрого поиска информации, взаимосвязи данных между собой до&nbsp;использования этих данных в&nbsp;различных прикладных программах и&nbsp;одновременного доступа к&nbsp;данным нескольких пользователей.<br /><br /><a name="p71139-7"></a>
Для&nbsp;точности дадим определение базы данных, предлагаемое <!--notypo-->Глоссарий.ру<!--/notypo--><br /><br /><a name="p71139-8"></a>
База данных – это&nbsp;совокупность связанных данных, организованных по&nbsp;определенным правилам, предусматривающим общие принципы описания, хранения и&nbsp;манипулирования, независимая от&nbsp;прикладных программ. База данных является информационной моделью предметной области. Обращение к&nbsp;базам данных осуществляется с&nbsp;помощью системы управления базами данных (СУБД). СУБД обеспечивает поддержку создания баз&nbsp;данных, централизованного управления и&nbsp;организации доступа к&nbsp;ним различных пользователей.<br /><br /><a name="p71139-9"></a>
Итак, мы&nbsp;пришли к&nbsp;выводу, что&nbsp;хранить данные независимо от&nbsp;программ, так, что&nbsp;они связаны между собой и&nbsp;организованы по&nbsp;определенным правилам, целесообразно. Но&nbsp;вопрос, как&nbsp;хранить данные, по&nbsp;каким правилам они&nbsp;должны быть организованы, остался открытым. Способов существует множество (кстати, называются они&nbsp;моделями представления или&nbsp;хранения данных). Наиболее популярные – объектная и&nbsp;реляционная модели данных.<br /><br /><a name="p71139-10"></a>
Автором реляционной модели считается Э. Кодд, который первым предложил использовать для&nbsp;обработки данных аппарат теории множеств (объединение, пересечение, разность, декартово произведение) и&nbsp;показал, что&nbsp;любое представление данных сводится к&nbsp;совокупности двумерных таблиц особого вида, известного в&nbsp;математике как&nbsp;отношение.<br /><br /><a name="p71139-11"></a>
Таким образом, реляционная база данных представляет собой набор таблиц (точно таких же, как&nbsp;приведенная выше), связанных между собой. Строка в&nbsp;таблице соответствует сущности реального мира (в приведенном выше примере это&nbsp;информация о&nbsp;человеке).<br /><br /><a name="p71139-12"></a>
Примеры реляционных СУБД: Mysql, <!--notypo-->PostgreSql<!--/notypo-->. В&nbsp;основу объектной модели положена концепция объектно-ориентированного программирования, в&nbsp;которой данные представляются в&nbsp;виде набора объектов и&nbsp;классов, связанных между собой родственными отношениями, а&nbsp;работа с&nbsp;объектами осуществляется с&nbsp;помощью скрытых (инкапсулированных) в&nbsp;них<br />
методов.<br /><br /><a name="p71139-13"></a>
Примеры объектных СУБД: Cache, <!--notypo-->GemStone<!--/notypo--> (от Servio Corporation), ONTOS (ONTOS).<br /><br /><a name="p71139-14"></a>
В&nbsp;последнее время производители СУБД стремятся соединить два&nbsp;этих подхода и&nbsp;проповедуют объектно-реляционную модель представления данных. Примеры таких СУБД – IBM&nbsp;DB2 for&nbsp;Common Servers, <!--notypo-->Oracle8<!--/notypo-->.<br /><br /><a name="p71139-15"></a>
Поскольку мы&nbsp;собираемся работать с&nbsp;Mysql, то&nbsp;будем обсуждать аспекты работы только с&nbsp;реляционными базами данных. Нам&nbsp;осталось рассмотреть еще&nbsp;два важных понятия из&nbsp;этой области: ключи и&nbsp;индексирование, после чего мы&nbsp;сможем приступить к&nbsp;изучению языка запросов SQL.<br /><a name="h177-2"></a><h2>1. Ключи</h2>
<br /><a name="p71139-16"></a>
Для&nbsp;начала давайте подумаем над&nbsp;таким вопросом: какую информацию нужно дать о&nbsp;человеке, чтобы собеседник точно сказал, что&nbsp;это именно тот&nbsp;человек, сомнений быть не&nbsp;может, второго такого нет? Сообщить фамилию, очевидно, недостаточно, поскольку существуют однофамильцы. Если собеседник человек, то&nbsp;мы можем приблизительно объяснить, о&nbsp;ком речь, например вспомнить поступок, который совершил тот&nbsp;человек, или&nbsp;еще как-то. Компьютер же&nbsp;такого объяснения не&nbsp;поймет, ему&nbsp;нужны четкие правила, как&nbsp;определить, о&nbsp;ком идет речь. В&nbsp;системах управления базами данных для&nbsp;решения такой задачи ввели понятие первичного ключа.<br /><br /><a name="p71139-17"></a>
Первичный ключ (primary key, PK) – минимальный набор полей, уникально идентифицирующий запись в&nbsp;таблице. Значит, первичный ключ – это&nbsp;в&nbsp;первую очередь набор полей таблицы, во-вторых, каждый набор значений этих полей должен определять единственную запись (строку) в&nbsp;таблице и, в-третьих, этот набор полей должен быть минимальным из&nbsp;всех обладающих таким же&nbsp;свойством.<br /><br /><a name="p71139-18"></a>
Поскольку первичный ключ определяет только одну уникальную запись, то&nbsp;никакие две&nbsp;записи таблицы не&nbsp;могут иметь одинаковых значений первичного ключа.<br /><br /><a name="p71139-19"></a>
Например, в&nbsp;нашей таблице (см. выше) ФИО&nbsp;и&nbsp;адрес позволяют однозначно выделить запись о&nbsp;человеке. Если же&nbsp;говорить в&nbsp;общем, без&nbsp;связи с&nbsp;решаемой задачей, то&nbsp;такие знания не&nbsp;позволяют точно указать на&nbsp;единственного человека, поскольку существуют однофамильцы, живущие в&nbsp;разных городах по&nbsp;одному адресу. Все&nbsp;дело в&nbsp;границах, которые мы&nbsp;сами себе задаем. Если считаем, что&nbsp;знания ФИО, телефона и&nbsp;адреса без&nbsp;указания города для&nbsp;наших целей достаточно, то&nbsp;все замечательно, тогда поля ФИО&nbsp;и&nbsp;адрес могут образовывать первичный ключ. В&nbsp;любом случае проблема создания первичного ключа ложится на&nbsp;плечи того, кто&nbsp;проектирует базу данных (разрабатывает структуру хранения данных). Решением этой проблемы может стать либо выделение характеристик, которые естественным образом определяют запись в&nbsp;таблице (задание так&nbsp;называемого логического, или&nbsp;естественного, PK), либо создание дополнительного поля, предназначенного именно для&nbsp;однозначной идентификации записей в&nbsp;таблице (задание так&nbsp;называемого суррогатного, или&nbsp;искусственного, PK).<br /><br /><a name="p71139-20"></a>
Примером логического первичного ключа является номер паспорта в&nbsp;базе данных о&nbsp;паспортных данных жителей или&nbsp;ФИО и&nbsp;адрес в&nbsp;телефонной книге (таблица выше). Для&nbsp;задания суррогатного первичного ключа в&nbsp;нашу таблицу можно добавить поле id&nbsp;(идентификатор), значением которого будет целое число, уникальное для&nbsp;каждой строки таблицы. Использование таких суррогатных ключей имеет смысл, если естественный первичный ключ представляет собой большой набор полей или&nbsp;его выделение нетривиально.<br /><br /><a name="p71139-21"></a>
Кроме однозначной идентификации записи, первичные ключи используются для&nbsp;организации связей с&nbsp;другими таблицами.<br /><br /><a name="p71139-22"></a>
Например, у&nbsp;нас есть три&nbsp;таблицы: содержащая информацию об&nbsp;исторических личностях (Persons), содержащая информацию об&nbsp;их изобретениях (Artifacts) и&nbsp;содержащая изображения как&nbsp;личностей, так&nbsp;и&nbsp;артефактов (Images) (рис 10.1).<br /><br /><a name="p71139-23"></a>
Первичным ключом во&nbsp;всех этих таблицах является поле id&nbsp;(идентификатор). В&nbsp;таблице Artifacts есть поле author, в&nbsp;котором записан идентификатор, присвоенный автору изобретения в&nbsp;таблице Persons. Каждое значение этого поля является внешним ключом для&nbsp;первичного ключа таблицы Persons. Кроме того, в&nbsp;таблицах Persons и&nbsp;Artifacts есть поле photo, которое ссылается на&nbsp;изображение в&nbsp;таблице Images. Эти&nbsp;поля также являются внешними ключами для&nbsp;первичного ключа таблицы Images и&nbsp;устанавливают однозначную логическую связь Persons-Images и&nbsp;Artifacts-Images. То&nbsp;есть если значение внешнего ключа photo в&nbsp;таблице личности равно 10, то&nbsp;это значит, что&nbsp;фотография этой личности имеет id=10 в&nbsp;таблице изображений. Таким образом, внешние ключи используются для&nbsp;организации связей между таблицами базы данных (родительскими и&nbsp;дочерними) и&nbsp;для поддержания ограничений ссылочной целостности данных.<br /><a name="h177-3"></a><h2>2. Индексирование</h2>
<br /><a name="p71139-24"></a>
Одна из&nbsp;основных задач, возникающих при&nbsp;работе с&nbsp;базами данных, – это&nbsp;задача поиска. При&nbsp;этом, поскольку информации в&nbsp;базе данных, как&nbsp;правило, содержится много, перед программистами встает задача не&nbsp;просто поиска, а&nbsp;эффективного поиска, т.е. поиска за&nbsp;сравнительно небольшое время и&nbsp;с достаточной точностью. <br /><br /><a name="p71139-25"></a>
Для&nbsp;этого (для оптимизации производительности запросов) производят индексирование некоторых полей таблицы. Использовать индексы полезно для&nbsp;быстрого поиска строк с&nbsp;указанным значением одного столбца. Без&nbsp;индекса чтение таблицы осуществляется по&nbsp;всей таблице, начиная с&nbsp;первой записи, пока не&nbsp;будут найдены соответствующие строки. Чем&nbsp;больше таблица, тем&nbsp;больше накладные расходы. Если же&nbsp;таблица содержит индекс по&nbsp;рассматриваемым столбцам, то&nbsp;база данных может быстро определить позицию для&nbsp;поиска в&nbsp;середине файла данных без&nbsp;просмотра всех данных. Это&nbsp;происходит потому, что&nbsp;база данных помещает проиндексированные поля поближе в&nbsp;памяти, так, чтобы можно было побыстрее найти их&nbsp;значения. Для&nbsp;таблицы, содержащей 1000 строк, это&nbsp;будет как&nbsp;минимум в&nbsp;100 раз&nbsp;быстрее по&nbsp;сравнению с&nbsp;последовательным перебором всех записей. Однако в&nbsp;случае, когда необходим доступ почти ко&nbsp;всем 1000 строкам, быстрее будет последовательное чтение, так&nbsp;как при&nbsp;этом не&nbsp;требуется операций поиска по&nbsp;диску. Так&nbsp;что иногда индексы бывают только помехой. Например, если копируется большой объем данных в&nbsp;таблицу, то&nbsp;лучше не&nbsp;иметь никаких индексов. Однако в&nbsp;некоторых случаях требуется задействовать сразу несколько индексов (например, для&nbsp;обработки запросов к&nbsp;часто используемым таблицам).<br /><br /><a name="p71139-26"></a>
Если говорить о&nbsp;Mysql, то&nbsp;там существует три&nbsp;вида индексов: PRIMARY, UNIQUE, и&nbsp;INDEX, а&nbsp;слово ключ (KEY) используется как&nbsp;синоним слова индекс (INDEX). Все&nbsp;индексы хранятся в&nbsp;памяти в&nbsp;виде B-деревьев.<br /><br /><a name="p71139-27"></a>
PRIMARY – уникальный индекс (ключ) с&nbsp;ограничением, что&nbsp;все индексированные им&nbsp;поля не&nbsp;могут иметь пустого значения (т.е. они&nbsp;NOT NULL). Таблица может иметь только один первичный индекс, но&nbsp;он может состоять из&nbsp;нескольких полей.<br /><br /><a name="p71139-28"></a>
UNIQUE – ключ (индекс), задающий поля, которые могут иметь только уникальные значения.<br /><br /><a name="p71139-29"></a>
INDEX – обычный индекс (как мы&nbsp;описали выше). В&nbsp;Mysql, кроме того, можно индексировать строковые поля по&nbsp;заданному числу символов от&nbsp;начала строки.<br /><a name="h177-4"></a><h2>3. СУБД Mysql</h2>
<br /><a name="p71139-30"></a>
Продолжим разговор о&nbsp;СУБД Mysql. Mysql – это&nbsp;реляционная система управления базами данных. То&nbsp;есть данные в&nbsp;ее базах хранятся в&nbsp;виде логически связанных между собой таблиц, доступ к&nbsp;которым осуществляется с&nbsp;помощью языка запросов SQL. Mysql – свободно распространяемая система, т.е. платить за&nbsp;ее применение не&nbsp;нужно. Кроме того, это&nbsp;достаточно быстрая, надежная и, главное, простая в&nbsp;использовании СУБД, вполне подходящая для&nbsp;не&nbsp;слишком глобальных проектов.<br /><br /><a name="p71139-31"></a>
Работать с&nbsp;Mysql можно не&nbsp;только в&nbsp;текстовом режиме, но&nbsp;и в&nbsp;графическом. Существует очень популярный визуальный интерфейс (кстати, написанный на&nbsp;PHP) для&nbsp;работы с&nbsp;этой СУБД. Называется он&nbsp;<!--notypo-->PhpMyAdmin<!--/notypo-->. Этот интерфейс позволяет значительно упростить работу с&nbsp;базами данных в&nbsp;Mysql.<br /><br /><a name="p71139-32"></a>
<!--notypo-->PhpMyAdmin<!--/notypo--> позволяет пользоваться всеми достоинствами браузера, включая прокрутку изображения, если оно&nbsp;не&nbsp;умещается на&nbsp;экран. Многие из&nbsp;базовых SQLфункций работы с&nbsp;данными в&nbsp;<!--notypo-->PhpMyAdmin<!--/notypo--> сведены к&nbsp;интуитивно понятным интерфейсам и&nbsp;действиям, напоминающим переход по&nbsp;ссылкам в&nbsp;Internet. Но, тем&nbsp;не&nbsp;менее, стоит все&nbsp;же&nbsp;поработать и&nbsp;в текстовом режиме.<br /><br /><a name="p71139-33"></a>
Перед тем&nbsp;как переходить к&nbsp;детальному изучению языка SQL, несколько слов об&nbsp;установке Mysql и&nbsp;подготовке к&nbsp;работе. Если вы&nbsp;не собираетесь заниматься администрированием сервера, то&nbsp;информация, приведенная ниже, пригодится вам&nbsp;только для&nbsp;общего развития. Итак, устанавливается Mysql очень просто – автоматически, пару раз&nbsp;нажмите OK, и&nbsp;все. После этого вы&nbsp;можете зайти в&nbsp;директорию, где&nbsp;лежат файлы типа <!--notypo-->Mysql.exe<!--/notypo-->, <!--notypo-->Mysqld.exe<!--/notypo--> и&nbsp;т.п. (у нас&nbsp;под Windows XP&nbsp;это c:\Mysql\bin) Последний файл запускает Mysql-сервер. В&nbsp;некоторых системах сервер запускается в&nbsp;виде сервиса. После запуска сервера следует запустить Mysql-клиент, запустив программу <!--notypo-->Mysql.exe<!--/notypo-->. Здесь даже пароля не&nbsp;спросят. Более того, если вы&nbsp;наберете shell&gt; <!--notypo-->Mysql.exe<!--/notypo--> -u root или&nbsp;shell&gt;Mysql -u root Mysql то&nbsp;получите все&nbsp;права администратора Mysql сервера. Кстати, выполнять эти&nbsp;команды надо, находясь в&nbsp;той директории, где&nbsp;лежат файлы <!--notypo-->Mysql.exe<!--/notypo-->.<br />
Для&nbsp;начала, не&nbsp;вдаваясь в&nbsp;подробности команд, исправим эти&nbsp;два недочета (отсутствие пароля у&nbsp;администратора и&nbsp;возможность входа анонимным пользователям):<br /><br /><a name="p71139-34"></a>
<!--notypo--><div class="code"><code>shell&gt;&nbsp;Mysql&nbsp;-u&nbsp;root&nbsp;Mysql<br />
Mysql&gt;&nbsp;<font color=blue>UPDATE</font>&nbsp;<font color=blue>user</font>&nbsp;<font color=blue>SET</font>&nbsp;<font color=blue>Password</font>=<font color=blue>PASSWORD</font>('new_password')<br />
<font color=blue>WHERE</font>&nbsp;<font color=blue>user</font>='root';<br />
Mysql&gt;&nbsp;<font color=blue>DELETE</font>&nbsp;<font color=blue>FROM</font>&nbsp;<font color=blue>user</font>&nbsp;<font color=blue>WHERE</font>&nbsp;<font color=blue>user</font>='';<br />
Mysql&gt;&nbsp;FLUSH&nbsp;<font color=blue>PRIVILEGES</font>;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-35"></a>
Все&nbsp;данные о&nbsp;пользователях Mysql хранит в&nbsp;таблице user в&nbsp;специальной базе данных Mysql, доступ к&nbsp;которой имеет только администратор сервера. Поэтому, чтобы изменить какой-либо пароль, нужно изменить эту&nbsp;таблицу. Пароль задается с&nbsp;помощью функции PASSWORD, которая кодирует введенные данные. Кроме изменения пароля администратора, нужно еще&nbsp;удалить всех пользователей, не&nbsp;имеющих логина (команда DELETE). Команда Flush Privileges заставляет вступить в&nbsp;действие изменения, произошедшие в&nbsp;системной базе данных (Mysql).<br /><br /><a name="p71139-36"></a>
Теперь создадим базу данных, с&nbsp;которой будем работать (мы все&nbsp;еще работаем как&nbsp;администратор сервера):<br />
Mysql&gt;create database book;<br /><br /><a name="p71139-37"></a>
Как&nbsp;можно заметить, все&nbsp;команды в&nbsp;Mysql заканчиваются точкой с&nbsp;запятой. Если вы&nbsp;забыли поставить этот знак, то&nbsp;выдается приглашение его&nbsp;поставить до&nbsp;тех пор, пока это&nbsp;не&nbsp;будет сделано:<br />
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;show&nbsp;tables<br />
-&gt;<br />
-&gt;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-38"></a>
Теперь последнее действие – создадим простого пользователя, предоставим ему&nbsp;доступ к&nbsp;созданной базе данных, и&nbsp;начнем работать.<br /><br /><a name="p71139-39"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>GRANT</font>&nbsp;<font color=blue>ALL</font>&nbsp;<font color=blue>PRIVILEGES</font>&nbsp;<font color=blue>ON</font>&nbsp;book.*&nbsp;<font color=blue>TO</font>&nbsp;nina@localhost<br />
IDENTIFIED&nbsp;<font color=blue>BY</font>&nbsp;'123';<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-40"></a>
Команда GRANT наделяет пользователя nina, зашедшего на&nbsp;сервер с&nbsp;этой же&nbsp;машины (c localhost) и&nbsp;идентифицируемого паролем «123», определенными правами (в данном случае всеми) на&nbsp;все таблицы базы данных book. Теперь мы&nbsp;можем выйти и&nbsp;зайти как&nbsp;пользователь nina с&nbsp;соответствующим паролем:<br /><br /><a name="p71139-41"></a>
<!--notypo--><div class="code"><code>shell&gt;Mysql&nbsp;-u&nbsp;nina&nbsp;-p<br />
Enter&nbsp;<font color=blue>password</font>:&nbsp;***<br />
Welcome&nbsp;<font color=blue>to</font>&nbsp;the&nbsp;Mysql&nbsp;monitor!...<br />
Mysql&gt;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-42"></a>
Если вы&nbsp;собираетесь пользоваться базой данных на&nbsp;чужом сервере, то&nbsp;его администратор проделает все&nbsp;описанные выше действия за&nbsp;вас, т.е. все&nbsp;настроит и&nbsp;создаст пользователя и&nbsp;базу данных. В&nbsp;следующей главе описаны команды языка SQL, которые пригодятся для&nbsp;работы с&nbsp;данными, хранящимися в&nbsp;СУБД Mysql.

<br>
<p>
    
   
    
                            <h2>4.Язык SQL</h2>

<p>Итак, мы в общих чертах познакомились с основными понятиями теории баз данных, установили и настроили для работы Mysql. Теперь самое время научиться манипулировать данными, хранящимися в базах данных. Для этого нам понадобится SQL – структурированный язык запросов. Этот язык дает возможность создавать, редактировать и удалять информацию, хранящуюся в базах данных, создавать новые базы данных и многое другое. SQL является стандартом ANSI (Американский национальный институт стандартов) и ISO (Международная организация по стандартизации).
Немного истории</p>

<p>Первый международный стандарт языка SQL был принят в 1989 г., его часто называют SQL/89. Среди недостатков этого стандарта выделяют в первую очередь то, что многие важные свойства он устанавливал как определяемые в реализации.</p>

<p>Отсюда произошло множество расхождений в реализациях языка разными производителями. Кроме того, высказывались претензии по поводу отсутствия в этом стандарте упоминаний о практических аспектах языка, таких как его встраивание в язык программирования Си.</p>

<p>Следующий международный стандарт языка SQL был принят в конце 1992 г. И стал называться SQL/92. Он получился гораздо более точным и полным, чем SQL/89, хотя и не был лишен недостатков. В настоящее время большинство систем почти полностью реализуют этот стандарт. Однако, как известно, прогресс не остановишь, и в 1999 году появился новый стандарт SQL:1999, также известный как SQL3. SQL3 характеризуется как «объектно-ориентированный SQL» и является основой нескольких объектно-реляционных систем управления базами данных (например, ORACLE8 компании Oracle, Universal Server компании Informix и DB2 Universal Database компании IBM). Этот стандарт является не просто слиянием SQL-92 и объектной технологии. Он содержит ряд расширений традиционного SQL, а сам документ составлен таким образом, чтобы добиться более эффективной работы в области стандартизации в будущем.</p>

<p>Если говорить о Mysql, то она соответствует начальному уровню SQL92, содержит несколько расширений этого стандарта и стремится к полной поддержке стандарта ANSI SQL99, но без ущерба для скорости и качества кода.</p>

<p>Далее, говоря об основах языка SQL, будем придерживаться его реализации в СУБД Mysql.
    

</p>

<h2>5. Основные операторы языка SQL</h2>


<a name="p18513-1"></a>
<!--notypo--><fieldset><legend><strong> Оглавление документа   </strong></legend><div class="toc1"><a href="#h179-2">1. Оператор CREATE TABLE</a></div><div class="toc2"><a href="#h179-3">1.1. Синтаксис</a></div><div class="toc2"><a href="#h179-4">1.2. Последовательность</a></div><div class="toc1"><a href="#h179-5">2. Оператор DROP TABLE</a></div><div class="toc1"><a href="#h179-6">3. Оператор ALTER TABLE</a></div><div class="toc1"><a href="#h179-7">4. Оператор SELECT</a></div><div class="toc1"><a href="#h179-8">5. Оператор INSERT</a></div><div class="toc1"><a href="#h179-9">6. Оператор UPDATE</a></div><div class="toc1"><a href="#h179-10">7. Оператор DELETE</a></div></fieldset><!--/notypo--><br /><br /><a name="p18513-2"></a>
Функции любой СУБД включают:<br /><ul><li> создание, удаление, изменение базы данных (БД);
</li><li> добавление, изменение, удаление, назначение прав пользователя;
</li><li> внесение, удаление и&nbsp;изменение данных в&nbsp;БД (таблиц и&nbsp;записей);
</li><li> выборку данных из&nbsp;БД.</li></ul>
<br /><a name="p18513-3"></a>
К&nbsp;первым двум функциям имеют доступ только администраторы СУБД или&nbsp;привилегированные пользователи. Рассмотрим, как&nbsp;решаются последние две&nbsp;задачи (на самом деле это&nbsp;семь задач).<br /><br /><a name="p18513-4"></a>
Прежде чем&nbsp;что-либо делать с&nbsp;данными, нужно создать таблицы, в&nbsp;которых эти&nbsp;данные будут храниться, научиться изменять структуру этих таблиц и&nbsp;удалять их, если потребуется. Для&nbsp;этого в&nbsp;языке SQL&nbsp;существуют операторы CREATE TABLE, ALTER TABLE и&nbsp;DROP TABLE.<br /><a name="h179-2"></a><h2>1. Оператор CREATE TABLE</h2>
<br /><a name="p18513-5"></a>
Оператор CREATE TABLE создает таблицу с&nbsp;заданным именем в&nbsp;текущей базе данных. Правила для&nbsp;допустимых имен таблицы приведены в&nbsp;документации. Если нет&nbsp;активной текущей базы данных или&nbsp;указанная таблица уже&nbsp;существует, то&nbsp;возникает ошибка выполнения команды.<br /><br /><a name="p18513-6"></a>
В&nbsp;версии Mysql 3.22 и&nbsp;более поздних имя&nbsp;таблицы может быть указано как&nbsp;имя_базы_данных.имя_таблицы. Эта&nbsp;форма записи работает независимо от&nbsp;того, является ли&nbsp;указанная база данных текущей.<br /><br /><a name="p18513-7"></a>
В&nbsp;версии Mysql 3.23 при&nbsp;создании таблицы можно использовать ключевое слово TEMPORARY. Временная таблица автоматически удаляется по&nbsp;завершении соединения, а&nbsp;ее имя&nbsp;действительно только в&nbsp;течение данного соединения. Это&nbsp;означает, что&nbsp;в&nbsp;двух разных соединениях могут использоваться временные таблицы с&nbsp;одинаковыми именами без&nbsp;конфликта друг с&nbsp;другом или&nbsp;с&nbsp;существующей таблицей с&nbsp;тем же&nbsp;именем (существующая таблица скрыта, пока не&nbsp;удалена временная таблица). В&nbsp;версии Mysql 4.0.2 для&nbsp;создания временных таблиц необходимо иметь привилегии CREATE TEMPORARY TABLES.<br /><br /><a name="p18513-8"></a>
В&nbsp;версии Mysql 3.23 и&nbsp;более поздних можно использовать ключевые слова IF&nbsp;NOT EXISTS для&nbsp;того, чтобы не&nbsp;возникала ошибка, если указанная таблица уже&nbsp;существует. Следует учитывать, что&nbsp;при этом идентичность структур этих таблиц не&nbsp;проверяется.<br /><br /><a name="p18513-9"></a>
Каждая таблица представлена набором определенных файлов в&nbsp;директории базы данных.<br /><a name="h179-3"></a><h3>1.1. Синтаксис</h3>
<br /><a name="p18513-10"></a>
<!--notypo--><div class="code"><code><font color=blue>CREATE</font>&nbsp;[<font color=blue>TEMPORARY</font>]&nbsp;<font color=blue>TABLE</font>&nbsp;[<font color=blue>IF</font>&nbsp;<font color=blue>NOT</font>&nbsp;<font color=blue>EXISTS</font>]<br />
имя_таблицы&nbsp;[(определение_столбца,...)]<br />
[опции_таблицы]&nbsp;[select_выражение]<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-11"></a>
В&nbsp;выражении определение_столбца перечисляют, какие столбцы должны быть созданы в&nbsp;таблице. Каждый столбец таблицы может быть пустым (NULL), иметь значение по&nbsp;умолчанию, являться ключом или&nbsp;автоинкрементом. Кроме того, для&nbsp;каждого столбца обязательно указывается тип&nbsp;данных, которые будут в&nbsp;нем храниться. Если не&nbsp;указывается ни&nbsp;NULL, ни&nbsp;NOT NULL, то&nbsp;столбец интерпретируется так, как&nbsp;будто указано NULL. Если поле помечают как&nbsp;автоинкремент (AUTO_INCREMENT), то&nbsp;его значение автоматически увеличивается на&nbsp;единицу каждый раз, когда происходит добавление данных в&nbsp;таблицу и&nbsp;в это&nbsp;поле записывается пустое значение (NULL, т.е. ничего не<br />
записывается) или&nbsp;0. Автоинкремент в&nbsp;таблице может быть только один, и&nbsp;при этом он&nbsp;обязательно должен быть проиндексирован. <br /><a name="h179-4"></a><h3>1.2. Последовательность</h3>
<br /><a name="p18513-12"></a>
AUTO_INCREMENT начинается с&nbsp;1. Наличие автоинкремента является одной из&nbsp;особенностей Mysql. Формально описание столбца (определение_столбца) выглядит так:<br />
<!--notypo--><div class="code"><code>имя_столбца&nbsp;тип&nbsp;[<font color=blue>NOT</font>&nbsp;<font color=blue>NULL</font>&nbsp;|&nbsp;<font color=blue>NULL</font>]<br />
[<font color=blue>DEFAULT</font>&nbsp;значение_по_умолчанию]<br />
[AUTO_INCREMENT][<font color=blue>PRIMARY</font>&nbsp;<font color=blue>KEY</font>]<br />
[reference_definition]<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-13"></a>
Тип&nbsp;столбца (тип в&nbsp;выражении определение_столбца) может быть одним из&nbsp;следующих:<br /><ul><li> целый: INT[(length)] [UNSIGNED] [ZEROFILL]
</li><li> действительный: REAL[(length,decimals)] [UNSIGNED] [ZEROFILL]
</li><li> символьный: CHAR(length) [BINARY] и&nbsp;VARCHAR(length) [BINARY]
</li><li> дата и&nbsp;время: DATE и&nbsp;TIME
</li><li> для&nbsp;работы с&nbsp;большими объектами: BLOB
</li><li> текстовый: TEXT
</li><li> перечислимое множество: ENUM(value1,value2,value3,...) и&nbsp;SET(value1,value2,value3,...)</li></ul>
<br /><a name="p18513-14"></a>
Полный список типов смотрите в&nbsp;документации Mysql.<br /><br /><a name="p18513-15"></a>
Вместо перечисления столбцов и&nbsp;их свойств в&nbsp;определении_столбца можно задавать списки ключевых и&nbsp;индексных полей, ограничения и&nbsp;проверки:<br /><br /><a name="p18513-16"></a>
<!--notypo--><div class="code"><code><font color=blue>PRIMARY</font>&nbsp;<font color=blue>KEY</font>&nbsp;(имя_индексируемого_столбца,&nbsp;...)<font color=green><b></b></font></code></div><!--/notypo--><br />
или<br /><br /><a name="p18513-17"></a>
<!--notypo--><div class="code"><code><font color=blue>KEY</font>&nbsp;[имя_индекса]&nbsp;(имя_индексируемого_столбца,...)<font color=green><b></b></font></code></div><!--/notypo--><br />
или<br /><br /><a name="p18513-18"></a>
<!--notypo--><div class="code"><code><font color=blue>INDEX</font>&nbsp;[имя_индекса]&nbsp;(имя_индексируемого_столбца,...)<font color=green><b></b></font></code></div><!--/notypo--><br />
или<br /><br /><a name="p18513-19"></a>
<!--notypo--><div class="code"><code><font color=blue>UNIQUE</font>&nbsp;[<font color=blue>INDEX</font>]&nbsp;[имя_индекса]<br />
(имя_индексируемого_столбца,...)<font color=green><b></b></font></code></div><!--/notypo--><br />
или<br /><br /><a name="p18513-20"></a>
<!--notypo--><div class="code"><code>FULLTEXT&nbsp;[<font color=blue>INDEX</font>]&nbsp;[имя_индекса]<br />
(имя_индексируемого_столбца,...)<font color=green><b></b></font></code></div><!--/notypo--><br />
или<br /><br /><a name="p18513-21"></a>
<!--notypo--><div class="code"><code><font color=green><b></b></font>[<font color=blue>CONSTRAINT</font>&nbsp;symbol]<br />
<font color=blue>FOREIGN</font>&nbsp;<font color=blue>KEY</font>&nbsp;[имя_индекса]<br />
(имя_индексируемого_столбца,...)<br />
[reference_definition]<font color=green><b></b></font></code></div><!--/notypo--><br />
или<br /><br /><a name="p18513-22"></a>
<!--notypo--><div class="code"><code><font color=blue>CHECK</font>&nbsp;(expr)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-23"></a>
При&nbsp;задании всех этих элементов указывается список полей (столбцов), которые будут входить в&nbsp;индекс, ключ или&nbsp;ограничение, имя_индексируемого_столбца записывается следующим образом:<br /><br /><a name="p18513-24"></a>
имя_столбца [(длина_индекса)]<br />
FOREIGN KEY, CHECK и&nbsp;REFERENCES на&nbsp;самом деле ничего не&nbsp;делают в&nbsp;Mysql. Они&nbsp;добавлены только для&nbsp;совместимости с&nbsp;другими SQL-серверами.<br /><br /><a name="p18513-25"></a>
Поэтому на&nbsp;них мы&nbsp;останавливаться не&nbsp;будем.<br /><br /><a name="p18513-26"></a>
Кроме всего перечисленного, при&nbsp;создании таблицы можно указать некоторые ее&nbsp;свойства (опции_таблицы), например такие:<br /><ul><li> тип&nbsp;таблицы: TYPE = {BDB | HEAP | ISAM | <span class="missingpage">Inno&nbsp;DB</span><a href="http://www.webmasterwiki.ru/MySQL/InnoDB/edit?add=1" title="Создать эту страницу">?</a> | MERGE | MRG_MYISAM | MYISAM }
</li><li> начальное значение счетчика автоинкремента: AUTO_INCREMENT = число
</li><li> средняя длина строк в&nbsp;таблице: AVG_ROW_LENGTH = число
</li><li> комментарии к&nbsp;таблице (строка из&nbsp;60 символов): COMMENT = &laquo;строка&raquo; максимальное и&nbsp;минимальное предполагаемое число строк: MAX_ROWS = число и&nbsp;MIN_ROWS = число</li></ul>
<br /><a name="p18513-27"></a>
И&nbsp;последний (опять же&nbsp;опциональный) элемент команды CREATE – это&nbsp;выражение SELECT (select_выражение). Синтаксис такой: <br />
<!--notypo--><div class="code"><code><font color=green><b></b></font>[IGNORE&nbsp;|&nbsp;REPLACE]&nbsp;<font color=blue>SELECT</font>&nbsp;...<br />
(любое&nbsp;корректное&nbsp;выражение&nbsp;<font color=blue>SELECT</font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-28"></a>
Если при&nbsp;создании таблицы в&nbsp;команде CREATE указывается выражение SELECT, то&nbsp;все поля, полученные выборкой, добавляются в&nbsp;создаваемую таблицу.<br /><br /><a name="p18513-29"></a>
<strong>Пример 10.1. Создание таблицы Persons</strong><br /><br /><a name="p18513-30"></a>
<!--notypo--><div class="code"><code>Mysql&gt;<font color=blue>CREATE</font>&nbsp;<font color=blue>TABLE</font>&nbsp;Persons<br />
(id&nbsp;<font color=blue>INT</font>&nbsp;<font color=blue>PRIMARY</font>&nbsp;<font color=blue>KEY</font>&nbsp;AUTO_INCREMENT,<br />
first_name&nbsp;<font color=blue>VARCHAR</font>(<font color=green><b>50</b></font>),&nbsp;last_name<br />
<font color=blue>VARCHAR</font>(<font color=green><b>100</b></font>),&nbsp;death_date&nbsp;<font color=blue>INT</font>,<br />
description&nbsp;TEXT,&nbsp;photo&nbsp;<font color=blue>INT</font>,<br />
citienship&nbsp;<font color=blue>CHAR</font>(<font color=green><b>50</b></font>)&nbsp;<font color=blue>DEFAULT</font>&nbsp;'Russia');<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-31"></a>
С&nbsp;помощью специфичной для&nbsp;Mysql команды SHOW можно просмотреть существующие базы данных, таблицы в&nbsp;базе данных и&nbsp;поля в&nbsp;таблице.<br /><br /><a name="p18513-32"></a>
Показать все&nbsp;базы данных:<br /><br /><a name="p18513-33"></a>
<!--notypo--><div class="code"><code>Mysql&gt;SHOW&nbsp;databases;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-34"></a>
Сделать текущей базу данных book и&nbsp;показать все&nbsp;таблицы в&nbsp;ней:<br /><br /><a name="p18513-35"></a>
<!--notypo--><div class="code"><code>Mysql&gt;<font color=blue>use</font>&nbsp;book;<br />
Mysql&gt;show&nbsp;tables;<font color=green><b></b></font></code></div><!--/notypo--><br />
Показать все&nbsp;столбцы в&nbsp;таблице Persons:<br /><br /><a name="p18513-36"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;show&nbsp;columns&nbsp;<font color=blue>from</font>&nbsp;Persons;<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h179-5"></a><h2>2. Оператор DROP TABLE</h2>
<br /><a name="p18513-37"></a>
Оператор DROP TABLE удаляет одну или&nbsp;несколько таблиц. Все&nbsp;табличные данные и&nbsp;определения удаляются, так&nbsp;что при&nbsp;работе с&nbsp;этой командой следует соблюдать осторожность.<br /><br /><a name="p18513-38"></a>
Синтаксис:<br /><br /><a name="p18513-39"></a>
<!--notypo--><div class="code"><code><font color=blue>DROP</font>&nbsp;<font color=blue>TABLE</font>&nbsp;[<font color=blue>IF</font>&nbsp;<font color=blue>EXISTS</font>]&nbsp;имя_таблицы<br />
[,&nbsp;имя_таблицы,...]<br />
[<font color=blue>RESTRICT</font>&nbsp;|&nbsp;<font color=blue>CASCADE</font>]<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-40"></a>
В&nbsp;версии Mysql 3.22 и&nbsp;более поздних можно использовать ключевые слова IF&nbsp;EXISTS, чтобы предупредить ошибку, если указанные таблицы не&nbsp;существуют.<br /><br /><a name="p18513-41"></a>
Опции RESTRICT и&nbsp;CASCADE позволяют упростить перенос программы с&nbsp;других СУБД. В&nbsp;данный момент они&nbsp;не&nbsp;задействованы.<br /><br /><a name="p18513-42"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>DROP</font>&nbsp;<font color=blue>TABLE</font>&nbsp;<font color=blue>IF</font>&nbsp;<font color=blue>EXISTS</font>&nbsp;Persons,<br />
Artifacts,&nbsp;test;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-43"></a>
<strong>Пример 10.2. Использование оператора DROP TABLE</strong><br /><a name="h179-6"></a><h2>3. Оператор ALTER TABLE</h2>
<br /><a name="p18513-44"></a>
Оператор ALTER TABLE обеспечивает возможность изменять структуру существующей таблицы. Например, можно добавлять или&nbsp;удалять столбцы, создавать или&nbsp;уничтожать индексы или&nbsp;переименовывать столбцы либо саму таблицу. Можно также изменять комментарий для&nbsp;таблицы и&nbsp;ее тип.<br /><br /><a name="p18513-45"></a>
Синтаксис:<br />
<!--notypo--><div class="code"><code><font color=blue>ALTER</font>&nbsp;[IGNORE]&nbsp;<font color=blue>TABLE</font>&nbsp;имя_таблицы<br />
alter_specification<br />
[,&nbsp;alter_specification&nbsp;...]<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-46"></a>
Можно производить следующие изменения в&nbsp;таблице (все они&nbsp;записываются в&nbsp;alter_specification):<br /><ul><li> добавление поля:</li></ul><a name="p18513-47"></a>
<!--notypo--><div class="code"><code><font color=blue>ADD</font>&nbsp;[<font color=blue>COLUMN</font>]&nbsp;определение_столбца<br />
[<font color=blue>FIRST</font>&nbsp;|&nbsp;<font color=blue>AFTER</font>&nbsp;имя_столбца&nbsp;]<br />
или<br />
<font color=blue>ADD</font>&nbsp;[<font color=blue>COLUMN</font>]&nbsp;(определение_столбца,<br />
определение_столбца,...)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-48"></a>
Здесь, как&nbsp;и&nbsp;далее, определение_столбца записывается так&nbsp;же, как&nbsp;при создании таблицы.<br /><br />
<ul><li> добавление индексов:</li></ul><a name="p18513-49"></a>
<!--notypo--><div class="code"><code><font color=blue>ADD</font>&nbsp;<font color=blue>INDEX</font>&nbsp;[имя_индекса]&nbsp;(имя_индексируемого_столбца,...)&nbsp;или&nbsp;<font color=blue>ADD</font><br />
<font color=blue>PRIMARY</font>&nbsp;<font color=blue>KEY</font>&nbsp;(имя_индексируемого_столбца,...)&nbsp;или&nbsp;<font color=blue>ADD</font>&nbsp;<font color=blue>UNIQUE</font><br />
[имя_индекса]&nbsp;(имя_индексируемого_столбца,...)&nbsp;или&nbsp;<font color=blue>ADD</font>&nbsp;FULLTEXT<br />
[имя_индекса]&nbsp;(имя_индексируемого_столбца,...)<font color=green><b></b></font></code></div><!--/notypo--><br /><br />
<ul><li> изменение поля:</li></ul><a name="p18513-50"></a>
<!--notypo--><div class="code"><code><font color=blue>ALTER</font>&nbsp;[<font color=blue>COLUMN</font>]&nbsp;имя_столбца&nbsp;{<font color=blue>SET</font>&nbsp;<font color=blue>DEFAULT</font>&nbsp;literal&nbsp;|&nbsp;<font color=blue>DROP</font>&nbsp;<font color=blue>DEFAULT</font>}&nbsp;или<br />
CHANGE&nbsp;[<font color=blue>COLUMN</font>]&nbsp;старое_имя_столбца&nbsp;определение_столбца&nbsp;или<br />
MODIFY&nbsp;[<font color=blue>COLUMN</font>]&nbsp;определение_столбца</code></div><!--/notypo--><br /><br />
<ul><li> удаление поля, индекса, ключа:</li></ul><a name="p18513-51"></a>
<!--notypo--><div class="code"><code><font color=blue>DROP</font>&nbsp;[<font color=blue>COLUMN</font>]&nbsp;имя_столбца<br />
<font color=blue>DROP</font>&nbsp;<font color=blue>PRIMARY</font>&nbsp;<font color=blue>KEY</font><br />
<font color=blue>DROP</font>&nbsp;<font color=blue>INDEX</font>&nbsp;имя_индекса</code></div><!--/notypo--><br /><br />
<ul><li> переименование таблицы:</li></ul><a name="p18513-52"></a>
<!--notypo--><div class="code"><code>RENAME&nbsp;[<font color=blue>TO</font>]&nbsp;новое_имя_таблицы</code></div><!--/notypo--><br /><br />
<ul><li> переупорядочение полей таблицы:</li></ul><a name="p18513-53"></a>
<!--notypo--><div class="code"><code><font color=blue>ORDER</font>&nbsp;<font color=blue>BY</font>&nbsp;поле<br />
или<br />
опции_таблицы</code></div><!--/notypo--><br /><br /><a name="p18513-54"></a>
Если оператор ALTER TABLE используется для&nbsp;изменения определения типа столбца, но&nbsp;DESCRIBE имя_таблицы показывает, что&nbsp;столбец не&nbsp;изменился, то, возможно, Mysql игнорирует данную модификацию по&nbsp;одной из&nbsp;причин, описанных в&nbsp;специальном разделе документации. Например, при&nbsp;попытке изменить столбец VARCHAR на&nbsp;CHAR Mysql будет продолжать использовать VARCHAR, если данная таблица содержит другие столбцы с&nbsp;переменной длиной.<br /><br /><a name="p18513-55"></a>
Оператор ALTER TABLE во&nbsp;время работы создает временную копию исходной таблицы. Требуемое изменение выполняется на&nbsp;копии, затем исходная таблица удаляется, а&nbsp;новая переименовывается. Это&nbsp;делается для&nbsp;того, чтобы в&nbsp;новую таблицу автоматически попадали все&nbsp;обновления, кроме неудавшихся. Во&nbsp;время выполнения ALTER TABLE исходная таблица доступна для&nbsp;чтения другими клиентами. <br /><br /><a name="p18513-56"></a>
Операции обновления и&nbsp;записи в&nbsp;этой таблице приостанавливаются, пока не&nbsp;будет готова новая таблица. Следует отметить, что&nbsp;при использовании любой другой опции для&nbsp;ALTER TABLE, кроме RENAME, Mysql всегда будет создавать временную таблицу, даже если данные, строго говоря, и&nbsp;не нуждаются в&nbsp;копировании (например, при&nbsp;изменении имени столбца).<br /><br /><a name="p18513-57"></a>
<strong>Пример 10.3. Добавим в&nbsp;созданную таблицу Persons поле для&nbsp;записи года рождения человека:</strong><br /><br /><a name="p18513-58"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>ALTER</font>&nbsp;<font color=blue>TABLE</font>&nbsp;Persons<br />
<font color=blue>ADD</font>&nbsp;bday&nbsp;<font color=blue>INTEGER</font>&nbsp;<font color=blue>AFTER</font>&nbsp;last_name;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-59"></a>
Пример 10.3. Добавление в&nbsp;таблицу Persons поля для&nbsp;записи года рождения человека<br /><br /><a name="p18513-60"></a>
Итак, мы&nbsp;научились работать с&nbsp;таблицами: создавать, удалять и&nbsp;изменять их.<br /><br /><a name="p18513-61"></a>
Теперь разберемся, как&nbsp;делать то&nbsp;же самое с&nbsp;данными, которые в&nbsp;этих таблицах хранятся.<br /><a name="h179-7"></a><h2>4. Оператор SELECT</h2>
<br /><a name="p18513-62"></a>
Оператор SELECT применяется для&nbsp;извлечения строк, выбранных из&nbsp;одной или&nbsp;нескольких таблиц. То&nbsp;есть с&nbsp;его помощью мы&nbsp;задаем столбцы или&nbsp;выражения, которые надо извлечь (select_выражения), таблицы (table_references), из&nbsp;которых должна производиться выборка, и, возможно, условие (where_definition), которому должны соответствовать данные в&nbsp;этих столбцах, и&nbsp;порядок, в&nbsp;котором эти&nbsp;данные нужно выдать.<br /><br /><a name="p18513-63"></a>
Кроме того, оператор SELECT можно использовать для&nbsp;извлечения строк, вычисленных без&nbsp;ссылки на&nbsp;какую-либо таблицу. Например, чтобы вычислить, чему равно 2*2, нужно просто написать<br />
Mysql&gt; SELECT 2*2;<br /><br /><a name="p18513-64"></a>
Упрощенно структуру оператора SELECT можно представить следующим образом:<br />
SELECT select_выражение1, select_выражение2,<br />
...<br />
<!--notypo--><div class="code"><code><font color=green><b></b></font>[<font color=blue>FROM</font>&nbsp;table_references<br />
[<font color=blue>WHERE</font>&nbsp;where_definition]<br />
[<font color=blue>ORDER</font>&nbsp;<font color=blue>BY</font>&nbsp;{число&nbsp;|&nbsp;имя_столбца&nbsp;|<br />
формула}<br />
[<font color=blue>ASC</font>&nbsp;|&nbsp;<font color=blue>DESC</font>],&nbsp;...]]<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-65"></a>
Квадратные скобки [ ] означают, что&nbsp;использование находящегося в&nbsp;них оператора необязательно, вертикальная черта | означает перечисление возможных вариантов. После ключевого слова ORDER BY&nbsp;указывают имя&nbsp;столбца, число (целое беззнаковое) или&nbsp;формулу и&nbsp;способ упорядочения (по возрастанию – ASC, или&nbsp;по&nbsp;убыванию – DESC). По&nbsp;умолчанию используется упорядочение по&nbsp;возрастанию.<br /><br /><a name="p18513-66"></a>
Когда в&nbsp;select_выражении мы&nbsp;пишем «*», это&nbsp;значит выбрать все&nbsp;столбцы. Кроме «*» в&nbsp;select_выражения могут использоваться функции типа max, min&nbsp;и&nbsp;avg.<br /><br /><a name="p18513-67"></a>
Пример 10.4. Выбрать из&nbsp;таблицы Persons все&nbsp;данные, для&nbsp;которых поле first_name имеет значение 'Александр':<br /><br /><a name="p18513-68"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>SELECT</font>&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;Persons<br />
<font color=blue>WHERE</font>&nbsp;first_name='Александр';<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-69"></a>
Пример 10.4. Использование оператора SELECT<br /><br /><a name="p18513-70"></a>
Выбрать название и&nbsp;описание (title, description) артефакта под&nbsp;номером 10:<br />
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>SELECT</font>&nbsp;title,description<br />
<font color=blue>FROM</font>&nbsp;Artifacts&nbsp;<font color=blue>WHERE</font>&nbsp;id=<font color=green><b>10</b></font>;<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h179-8"></a><h2>5. Оператор INSERT</h2>
<br /><a name="p18513-71"></a>
Оператор INSERT вставляет новые строки в&nbsp;существующую таблицу. Оператор имеет несколько форм. Параметр имя_таблицы во&nbsp;всех этих формах задает таблицу, в&nbsp;которую должны быть внесены строки. Столбцы, для&nbsp;которых задаются значения, указываются в&nbsp;списке имен столбцов (имя_столбца) или&nbsp;в&nbsp;части SET.<br /><br /><a name="p18513-72"></a>
Синтаксис:<br /><br />
<ul><li> INSERT [LOW_PRIORITY | DELAYED] [IGNORE]</li></ul><a name="p18513-73"></a>
[INTO] имя_таблицы [(имя_столбца,...)]<br />
VALUES (выражение,...),(...),...<br />
Эта&nbsp;форма команды INSERT вставляет строки в&nbsp;соответствии с&nbsp;точно указанными в&nbsp;команде значениями. В&nbsp;скобках после имени таблицы перечисляются столбцы, а&nbsp;после ключевого слова VALUES – их&nbsp;значения.<br /><br /><a name="p18513-74"></a>
Например:<br /><br /><a name="p18513-75"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;Persons<br />
(last_name,&nbsp;bday)&nbsp;<font color=blue>VALUES</font><br />
('Иванов',&nbsp;'1934');<font color=green><b></b></font></code></div><!--/notypo--><br />
вставит в&nbsp;таблицу Persons строку, в&nbsp;которой значения фамилии (last_name) и&nbsp;даты рождения (bday) будут заданы соответственно как&nbsp;«Иванов» и<br />
«1934».<br /><ul><li> INSERT [LOW_PRIORITY | DELAYED] [IGNORE]</li></ul><a name="p18513-76"></a>
[INTO] имя_таблицы [(имя_столбца,...)]<br />
SELECT ...<br /><br /><a name="p18513-77"></a>
Эта&nbsp;форма команды INSERT вставляет строки, выбранные из&nbsp;другой таблицы или&nbsp;таблиц.<br /><br /><a name="p18513-78"></a>
Например:<br /><br /><a name="p18513-79"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;Artifacts&nbsp;(author)<br />
<font color=blue>SELECT</font>&nbsp;id&nbsp;<font color=blue>FROM</font>&nbsp;Persons<br />
<font color=blue>WHERE</font>&nbsp;last_name='Иванов'<br />
<font color=blue>AND</font>&nbsp;bday='1934';<font color=green><b></b></font></code></div><!--/notypo--><br />
вставит в&nbsp;таблицу Artifacts в&nbsp;поле «автор» (author) значение идентификатора, выбранного из&nbsp;таблицы Persons по&nbsp;условию, что&nbsp;фамилия человека Иванов.<br /><ul><li> <!--notypo--><div class="code"><code><font color=blue>INSERT</font>&nbsp;[LOW_PRIORITY&nbsp;|&nbsp;DELAYED]&nbsp;[IGNORE]<br />
[<font color=blue>INTO</font>]&nbsp;имя_таблицы<br />
<font color=blue>SET</font>&nbsp;имя_столбца=выражение,<br />
имя_столбца=выражение,&nbsp;...<font color=green><b></b></font></code></div><!--/notypo--></li></ul>
<br /><a name="p18513-80"></a>
Например:<br /><br /><a name="p18513-81"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;Persons<br />
<font color=blue>SET</font>&nbsp;last_name='Петров',<br />
first_name='Иван';<font color=green><b></b></font></code></div><!--/notypo--><br />
Эта&nbsp;команда вставит в&nbsp;таблицу Persons в&nbsp;поле last_name значение «Петров», а&nbsp;в поле first_name – строку «Иван».<br /><br /><a name="p18513-82"></a>
Форма INSERT...  VALUES со&nbsp;списком из&nbsp;нескольких значений поддерживается в&nbsp;версии Mysql 3.22.5 и&nbsp;более поздних. Синтаксис выражения имя_столбца=выражение поддерживается в&nbsp;версии Mysql 3.22.10 и&nbsp;более поздних.<br /><br /><a name="p18513-83"></a>
Действуют следующие соглашения.<br /><ul><li> Если не&nbsp;указан список столбцов для&nbsp;INSERT...  VALUES или&nbsp;INSERT...  SELECT, то&nbsp;величины для&nbsp;всех столбцов должны быть определены в&nbsp;списке VALUES() или&nbsp;в&nbsp;результате работы SELECT. Если порядок столбцов в&nbsp;таблице неизвестен, для&nbsp;его получения можно использовать DESCRIBE имя_таблицы.
</li><li> Любой столбец, для&nbsp;которого явно не&nbsp;указано значение, будет установлен в&nbsp;свое значение по&nbsp;умолчанию. Например, если в&nbsp;заданном списке столбцов не&nbsp;указаны все&nbsp;столбцы в&nbsp;данной таблице, то&nbsp;не упомянутые столбцы устанавливаются в&nbsp;свои значения по&nbsp;умолчанию.
</li><li> Выражение expression может относиться к&nbsp;любому столбцу, который ранее был&nbsp;внесен в&nbsp;список значений. Например, можно указать следующее:</li></ul>
<br /><a name="p18513-84"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;имя_таблицы&nbsp;(col1,col2)<br />
<font color=blue>VALUES</font>(<font color=green><b>15</b></font>,col1*<font color=green><b>2</b></font>);<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-85"></a>
Но&nbsp;нельзя указать:<br /><br /><a name="p18513-86"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;имя_таблицы&nbsp;(col1,col2)<br />
<font color=blue>VALUES</font>(col2*<font color=green><b>2</b></font>,<font color=green><b>15</b></font>);<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-87"></a>
Мы&nbsp;еще не&nbsp;обсудили три&nbsp;необязательных параметра, присутствующих во&nbsp;всех трех формах команды: LOW_PRIORITY, DELAYED и&nbsp;IGNORE.<br /><br /><a name="p18513-88"></a>
Параметры LOW_PRIORITY и&nbsp;DELAYED используются, когда с&nbsp;таблицей работает большое число пользователей. Они&nbsp;предписывают устанавливать приоритет данной операции перед операциями других пользователей. Если указывается ключевое слово LOW_PRIORITY, то&nbsp;выполнение данной команды INSERT будет задержано до&nbsp;тех пор, пока другие клиенты не&nbsp;завершат чтение этой таблицы. В&nbsp;этом случае клиент должен ожидать, пока данная команда вставки не&nbsp;будет завершена, что&nbsp;в&nbsp;случае интенсивного использования таблицы может потребовать значительного времени. В&nbsp;противоположность этому команда INSERT DELAYED позволяет данному клиенту продолжать операцию сразу же, независимо от&nbsp;других пользователей.<br /><br /><a name="p18513-89"></a>
Если в&nbsp;команде INSERT указывается ключевое слово IGNORE, то&nbsp;все строки, имеющие дублирующиеся ключи PRIMARY или&nbsp;UNIQUE в&nbsp;этой таблице, будут проигнорированы и&nbsp;не внесены в&nbsp;таблицу. Если не&nbsp;указывать IGNORE, то&nbsp;данная операция вставки прекращается при&nbsp;обнаружении строки, имеющей дублирующееся значение существующего ключа.<br /><a name="h179-9"></a><h2>6. Оператор UPDATE</h2>
<br /><a name="p18513-90"></a>
Синтаксис:<br />
<!--notypo--><div class="code"><code><font color=blue>UPDATE</font>&nbsp;[LOW_PRIORITY]&nbsp;[IGNORE]&nbsp;имя_таблицы<br />
<font color=blue>SET</font>&nbsp;имя_столбца1=выражение1<br />
[,&nbsp;имя_столбца2=выражение2,&nbsp;...]<br />
[<font color=blue>WHERE</font>&nbsp;where_definition]<br />
[<font color=blue>LIMIT</font>&nbsp;число]<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-91"></a>
Оператор UPDATE обновляет значения существующих столбцов таблицы в&nbsp;соответствии с&nbsp;введенными значениями. В&nbsp;выражении SET&nbsp;указывается, какие именно столбцы следует модифицировать и&nbsp;какие величины должны быть в&nbsp;них установлены. В&nbsp;выражении WHERE, если оно&nbsp;присутствует, задается, какие строки подлежат обновлению. В&nbsp;остальных случаях обновляются все&nbsp;строки. Если задано выражение ORDER BY, то&nbsp;строки будут обновляться в&nbsp;указанном в&nbsp;нем порядке.<br /><br /><a name="p18513-92"></a>
Если указывается ключевое слово LOW_PRIORITY, то&nbsp;выполнение данной команды UPDATE задерживается до&nbsp;тех пор, пока другие клиенты не&nbsp;завершат чтение этой таблицы.<br /><br /><a name="p18513-93"></a>
Если указывается ключевое слово IGNORE, то&nbsp;команда обновления не&nbsp;будет прервана, даже если возникнет ошибка дублирования ключей. Строки, из-за которых возникают конфликтные ситуации, обновлены не&nbsp;будут.<br /><br /><a name="p18513-94"></a>
Если в&nbsp;выражении, которое задает новое значение столбца, используется имя&nbsp;этого поля, то&nbsp;команда UPDATE использует для&nbsp;этого столбца его&nbsp;текущее значение. Например, следующая команда устанавливает столбец death_date в&nbsp;значение, на&nbsp;единицу большее его&nbsp;текущей величины:<br /><br /><a name="p18513-95"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>UPDATE</font>&nbsp;Persons<br />
<font color=blue>SET</font>&nbsp;death_date=death_date+<font color=green><b>1</b></font>;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-96"></a>
В&nbsp;версии Mysql 3.23 можно использовать параметр LIMIT #, чтобы убедиться, что&nbsp;было изменено только заданное количество строк.<br /><br /><a name="p18513-97"></a>
Например, такая операция заменит в&nbsp;первой строке нашей таблицы экспонатов название title на&nbsp;строку «Ламповая ЭВМ»:<br />
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>UPDATE</font>&nbsp;Artifacts<br />
<font color=blue>SET</font>&nbsp;title='Ламповая&nbsp;ЭВМ'&nbsp;<font color=blue>Limit</font>&nbsp;<font color=green><b>1</b></font>;<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h179-10"></a><h2>7. Оператор DELETE</h2>
<br /><a name="p18513-98"></a>
Оператор DELETE удаляет из&nbsp;таблицы имя_таблицы строки, удовлетворяющие заданным в&nbsp;where_definition условиям, и&nbsp;возвращает число удаленных записей.<br /><br /><a name="p18513-99"></a>
Если оператор DELETE запускается без&nbsp;определения WHERE, то&nbsp;удаляются все&nbsp;строки.<br /><br /><a name="p18513-100"></a>
Синтаксис:<br /><br /><a name="p18513-101"></a>
<!--notypo--><div class="code"><code><font color=blue>DELETE</font>&nbsp;[LOW_PRIORITY]&nbsp;<font color=blue>FROM</font>&nbsp;имя_таблицы<br />
[<font color=blue>WHERE</font>&nbsp;where_definition]<br />
[<font color=blue>LIMIT</font>&nbsp;<font color=blue>rows</font>]<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-102"></a>
Например, следующая команда удалит из&nbsp;таблицы Persons все&nbsp;записи, у&nbsp;которых поле «год рождения» (bday) больше 2003:<br /><br /><a name="p18513-103"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>DELETE</font>&nbsp;<font color=blue>FROM</font>&nbsp;Persons&nbsp;<font color=blue>WHERE</font>&nbsp;bday&gt;<font color=green><b>2003</b></font>;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-104"></a>
Удалить все&nbsp;записи в&nbsp;таблице можно еще&nbsp;и&nbsp;с помощью такой команды:<br /><br /><a name="p18513-105"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>DELETE</font>&nbsp;<font color=blue>FROM</font>&nbsp;Persons&nbsp;<font color=blue>WHERE</font>&nbsp;<font color=green><b>1</b></font>&gt;<font color=green><b>0</b></font>;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-106"></a>
Но&nbsp;этот метод работает гораздо медленнее, чем&nbsp;использование той&nbsp;же&nbsp;команды без&nbsp;условия:<br /><br /><a name="p18513-107"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>DELETE</font>&nbsp;<font color=blue>FROM</font>&nbsp;Persons;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p18513-108"></a>
Специфическая для&nbsp;Mysql опция LIMIT для&nbsp;команды DELETE указывает серверу максимальное количество строк, которые следует удалить до&nbsp;возврата управления клиенту. Эта&nbsp;опция может использоваться для&nbsp;гарантии того, что&nbsp;данная команда DELETE не&nbsp;потребует слишком много времени для&nbsp;выполнения.<br /><br /><a name="p18513-109"></a>
В&nbsp;дистрибутив PHP&nbsp;входит расширение, содержащее встроенные функции для&nbsp;работы с&nbsp;базой данных Mysql. В&nbsp;этой лекции мы&nbsp;познакомимся с&nbsp;некоторыми основными функциями для&nbsp;работы с&nbsp;Mysql, которые потребуются для&nbsp;решения задач построения web-интерфейсов с&nbsp;целью отображения и&nbsp;наполнения базы данных. Возникает вопрос, зачем строить такие интерфейсы? Для&nbsp;того чтобы вносить информацию в&nbsp;базу данных и&nbsp;просматривать ее&nbsp;содержимое могли люди, не&nbsp;знакомые с&nbsp;языком запросов SQL. При&nbsp;работе с&nbsp;web-интерфейсом для&nbsp;добавления информации в&nbsp;базу данных человеку нужно просто ввести эти&nbsp;данные в&nbsp;html-форму и&nbsp;отправить их&nbsp;на сервер, а&nbsp;наш скрипт сделает все&nbsp;остальное. А&nbsp;для просмотра содержимого таблиц достаточно просто щелкнуть по&nbsp;ссылке и&nbsp;зайти на&nbsp;нужную страницу.<br /><br /><a name="p18513-110"></a>
Для&nbsp;наглядности будем строить эти&nbsp;интерфейсы для&nbsp;таблицы Artifacts, в&nbsp;которой содержится информация об&nbsp;экспонатах виртуального музея информатики. В&nbsp;предыдущей лекции мы&nbsp;уже приводили структуру этой коллекции, а&nbsp;также ее&nbsp;связи с&nbsp;коллекциями описания персон (Persons) и&nbsp;изображений (Images). Напомним, что&nbsp;каждый экспонат в&nbsp;коллекции Artifacts описывается с&nbsp;помощью следующих характеристик:<br /><ul><li> название (title);
</li><li> автор (author);
</li><li> описание (description);
</li><li> альтернативное название (alternative);
</li><li> изображение (photo).</li></ul>
<br /><a name="p18513-111"></a>
Название и&nbsp;альтернативное название являются строками менее чем&nbsp;255 символов длиной (т.е. имеют тип&nbsp;VARCHAR(255)), описание &ndash; текстовое поле (имеет тип&nbsp;TEXT), а&nbsp;в полях &laquo;автор&raquo; и&nbsp;&laquo;изображение&raquo; содержатся идентификаторы автора из&nbsp;коллекции Persons и&nbsp;изображения экспоната из&nbsp;коллекции Images соответственно.<br />   <script language="JavaScript" type="text/javascript">
   var dbclick = "page";
  </script>
<br style="clear:both" />&nbsp;
</div>

<hr><hr>
<h2>6. Типы данных MySQL</h2>

<a name="p-1044-1"></a>
<!--notypo--><fieldset><legend><strong> Оглавление документа   </strong></legend><div class="toc1"><a href="#h304-2">Целые числа</a></div><div class="toc2"><a href="#h304-3">INTEGER</a></div><div class="toc2"><a href="#h304-4">BIGINT</a></div><div class="toc2"><a href="#h304-5">TINYINT</a></div><div class="toc2"><a href="#h304-6">SMALLINT</a></div><div class="toc2"><a href="#h304-7">MEDIUMINT</a></div><div class="toc1"><a href="#h304-8">Десятичные</a></div><div class="toc2"><a href="#h304-9">DECIMAL</a></div><div class="toc2"><a href="#h304-10">FLOAT</a></div><div class="toc2"><a href="#h304-11">DOUBLE</a></div><div class="toc1"><a href="#h304-12">Логический тип</a></div><div class="toc2"><a href="#h304-13">BOOLEAN</a></div><div class="toc1"><a href="#h304-14">Символьные типы данных</a></div><div class="toc2"><a href="#h304-15">VARCHAR</a></div><div class="toc2"><a href="#h304-16">BLOB</a></div><div class="toc2"><a href="#h304-17">TEXT</a></div><div class="toc2"><a href="#h304-18">ENUM</a></div><div class="toc2"><a href="#h304-19">SET</a></div><div class="toc1"><a href="#h304-20">Тип данных даты и&nbsp;времени</a></div><div class="toc2"><a href="#h304-21">DATETIME</a></div><div class="toc2"><a href="#h304-22">DATE</a></div><div class="toc2"><a href="#h304-23">TIMESTAMP</a></div><div class="toc2"><a href="#h304-24">TIME</a></div><div class="toc2"><a href="#h304-25">YEAR</a></div></fieldset><!--/notypo--><br /><br /><a name="p-1044-2"></a>
Что&nbsp;и&nbsp;как и&nbsp;как много хранит <!--notypo-->MySQL<!--/notypo-->?<br /><br /><a name="p-1044-3"></a>
Данный материал создан для&nbsp;тех, кто&nbsp;только собирается определиться какой тип&nbsp;данных лучше выбрать для&nbsp;хранения значений в&nbsp;БД <!--notypo-->MySQL<!--/notypo-->.<br /><a name="h304-2"></a><h2>Целые числа</h2>
<br /><a name="p-1044-4"></a>
<strong>byte</strong> — кол-во байт на&nbsp;хранение, <br />
<strong>max/min</strong> — предельные значения, <br />
<strong>umax/umin</strong> — беззнаковые предельные значения<br /><a name="h304-3"></a><h3>INTEGER</h3>
<br /><a name="p-1044-5"></a>
Тип&nbsp;поля <strong>INT</strong> использует 4 байта для&nbsp;хранения значения. Минимально значение -2147483648, максимальное 2147483647. Беззнаковый <strong>INT</strong> (unsigned) хранит значения от&nbsp;0 до&nbsp;4294967295.<br /><br /><a name="p-1044-6"></a>
<!--notypo--><div class="code"><code>'int'=&gt;Array('byte'=&gt;<font color=green><b>4</b></font>,&nbsp;'min'=&gt;-2147483648,&nbsp;'max'=&gt;<font color=green><b>2147483647</b></font>,&nbsp;'umin'=&gt;<font color=green><b>0</b></font>,&nbsp;'umax'=&gt;<font color=green><b>4294967295</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-4"></a><h3>BIGINT</h3>
<br /><a name="p-1044-7"></a>
Тип&nbsp;поля <strong>BIGINT</strong> использует 4 байта для&nbsp;хранения значения. Минимальное значение -9223372036854775808, максимальное 9223372036854775807. Беззнаковый <strong>BIGINT</strong> (unsigned) хранит значения от&nbsp;0 до&nbsp;18446744073709551615.<br /><br /><a name="p-1044-8"></a>
<!--notypo--><div class="code"><code>'bigint'=&gt;Array('byte'=&gt;<font color=green><b>8</b></font>,&nbsp;'min'=&gt;-9223372036854775808,&nbsp;'max'=&gt;<font color=green><b>9223372036854775807</b></font>,&nbsp;'umin'=&gt;<font color=green><b>0</b></font>,&nbsp;'umax'=&gt;<font color=green><b>18446744073709551615</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-5"></a><h3>TINYINT</h3>
<br /><a name="p-1044-9"></a>
Тип&nbsp;поля <strong>TINYINT</strong> использует 1 байт для&nbsp;хранения значения. Минимальное значение -128, максимальное 127. Беззнаковый <strong>TINYINT</strong> (unsigned) хранит значения от&nbsp;0 до&nbsp;255.<br /><br /><a name="p-1044-10"></a>
 <!--notypo--><div class="code"><code>'tinyint'=&gt;Array('byte'=&gt;<font color=green><b>1</b></font>,&nbsp;'min'=&gt;-128,&nbsp;'max'=&gt;<font color=green><b>127</b></font>,&nbsp;'umin'=&gt;<font color=green><b>0</b></font>,&nbsp;'umax'=&gt;<font color=green><b>255</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-6"></a><h3>SMALLINT</h3>
<br /><a name="p-1044-11"></a>
Тип&nbsp;поля <strong>SMALLINT</strong> использует 1 байт для&nbsp;хранения значения. Минимальное значение -128, максимальное 127. Беззнаковый <strong>SMALLINT</strong> (unsigned) хранит значения от&nbsp;0 до&nbsp;255.<br /><br /><a name="p-1044-12"></a>
<!--notypo--><div class="code"><code>'smallint'=&gt;Array('byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'min'=&gt;-32768,&nbsp;'max'=&gt;<font color=green><b>32767</b></font>,&nbsp;'umin'=&gt;<font color=green><b>0</b></font>,&nbsp;'umax'=&gt;<font color=green><b>65535</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-7"></a><h3>MEDIUMINT</h3>
<br /><a name="p-1044-13"></a>
Тип&nbsp;поля <strong>MEDIUMINT</strong> использует 3 байта для&nbsp;хранения значения. Минимальное значение -8388608, максимальное 8388607. Беззнаковый <strong>MEDIUMINT</strong> (unsigned) хранит значения от&nbsp;0 до&nbsp;16777215.<br /><br /><a name="p-1044-14"></a>
<!--notypo--><div class="code"><code>'mediumint'=&gt;Array('byte'=&gt;<font color=green><b>3</b></font>,&nbsp;'min'=&gt;-8388608,&nbsp;'max'=&gt;<font color=green><b>8388607</b></font>,&nbsp;'umin'=&gt;<font color=green><b>0</b></font>,&nbsp;'umax'=&gt;<font color=green><b>16777215</b></font>),<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-8"></a><h2>Десятичные</h2><a name="h304-9"></a><h3>DECIMAL</h3>
<br /><a name="p-1044-15"></a>
<strong>DECIMAL   DECIMAL(M, D) m</strong> — кол-во цифр (max 65 цифр), d&nbsp;— сколько из&nbsp;них могут быть после запятой<br />
<strong>min_byte/max_byte</strong> — краевые значения размера поля в&nbsp;байтах,<br />
<strong>byte_formula</strong> — формула вычисления размерности<br />
<strong>length</strong> — максимальное кол-во цифр <br /><br /><a name="p-1044-16"></a>
Тип&nbsp;поля <strong>DECIMAL</strong>, <strong>DEC</strong>, <strong>NUMERIC</strong> используют от&nbsp;2 до&nbsp;67 байтов для&nbsp;хранения значения. <br /><br /><a name="p-1044-17"></a>
<!--notypo--><div class="code"><code>'decimal'=&gt;Array('min_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'max_byte'=&gt;<font color=green><b>67</b></font>,&nbsp;'byte_formula'=&gt;'(D==0?(M+<font color=green><b>1</b></font>):(M+<font color=green><b>2</b></font>)',&nbsp;'length'=&gt;<font color=green><b>65</b></font>)<br />
&nbsp;&nbsp;&nbsp;'dec'=&gt;Array('min_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'max_byte'=&gt;<font color=green><b>67</b></font>,&nbsp;'byte_formula'=&gt;'D==0?(M+<font color=green><b>1</b></font>):(M+<font color=green><b>2</b></font>)',&nbsp;'length'=&gt;<font color=green><b>65</b></font>)<br />
&nbsp;&nbsp;&nbsp;'numeric'=&gt;Array('min_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'max_byte'=&gt;<font color=green><b>67</b></font>,&nbsp;'byte_formula'=&gt;'D==0?(M+<font color=green><b>1</b></font>):(M+<font color=green><b>2</b></font>)',&nbsp;'length'=&gt;<font color=green><b>65</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-10"></a><h3>FLOAT</h3>
<br /><a name="p-1044-18"></a>
<strong>byte</strong> — кол-во байт для&nbsp;хранения поля (по-умолчанию)<br />
<strong>max_byte</strong> — максимальное кол-во байт для&nbsp;хранения<br />
<strong>negative_min/negative_max</strong> — минмаксы для&nbsp;отрицательных чисел <br />
<strong>positive_min/positive_max</strong> — минмаксы для&nbsp;положительных чисел<br />
у&nbsp;<strong>FLOAT</strong> ТОЧНОСТЬ ТОЛЬКО 7 ЦИФР (все остальные цифры «смазываются»)<br /><br /><a name="p-1044-19"></a>
Тип&nbsp;поля <strong>FLOAT</strong> использует от&nbsp;4 до&nbsp;8 байтов для&nbsp;хранения значения. Минимальное значение для&nbsp;отрицательных чисел -3.402823466E+38, максимальное &ndash; -1.175494351E-38. Минимальное значение для&nbsp;положительных чисел 1.175494351E-38, максимальное &ndash; 3.402823466E+38.<br /><br /><a name="p-1044-20"></a>
<!--notypo--><div class="code"><code>'float'=&gt;Array('byte'=&gt;<font color=green><b>4</b></font>,&nbsp;'max_byte'=&gt;<font color=green><b>8</b></font>,&nbsp;'negative_min'=&gt;-3.402823466E+<font color=green><b>38</b></font>,&nbsp;'negative_max'=&gt;-1.175494351E-38,&nbsp;'positive_min'=&gt;<font color=green><b>1</b></font>.175494351E-38,&nbsp;'positive_max'=&gt;<font color=green><b>3</b></font>.402823466E+<font color=green><b>38</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-11"></a><h3>DOUBLE</h3>
<br /><a name="p-1044-21"></a>
<strong>byte</strong> — кол-во байт для&nbsp;хранения поля (по-умолчанию)<br />
<strong>max_byte</strong> — максимальное кол-во байт для&nbsp;хранения<br />
<strong>negative_min/negative_max</strong> — минмаксы для&nbsp;отрицательных чисел <br />
<strong>positive_min/positive_max</strong> — минмаксы для&nbsp;положительных чисел<br />
у&nbsp;<strong>DOUBLE</strong> ТОЧНОСТЬ ТОЛЬКО 15 ЦИФР (все остальные цифры «смазываются»)<br /><br /><a name="p-1044-22"></a>
Тип&nbsp;поля <strong> DOUBLE</strong> использует 8 байтов для&nbsp;хранения значения. Минимальное значение для&nbsp;отрицательных чисел -1.7976931348623157E+308, максимальное &ndash; -2.2250738585072014E-308. Минимальное значение для&nbsp;положительных чисел 2.2250738585072014E-308, максимальное &ndash; 1.7976931348623157E+308.<br /><br /><a name="p-1044-23"></a>
<!--notypo--><div class="code"><code>'double'=&gt;Array('byte'=&gt;<font color=green><b>8</b></font>,&nbsp;'negative_min'=&gt;-1.7976931348623157E+<font color=green><b>308</b></font>,&nbsp;'negative_max'=&gt;-2.2250738585072014E-308,&nbsp;'positive_min'=&gt;<font color=green><b>2</b></font>.2250738585072014E-308,&nbsp;'positive_max'=&gt;<font color=green><b>1</b></font>.7976931348623157E+<font color=green><b>308</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1044-24"></a>
<span class="cite">Внимание</span>!<br />
Не&nbsp;храните денежные значения в&nbsp;этих полях! Деньги надо хранить — в&nbsp;DECIMAL<br /><a name="h304-12"></a><h2>Логический тип</h2><a name="h304-13"></a><h3>BOOLEAN</h3>
<br /><a name="p-1044-25"></a>
Тип&nbsp;поля <strong>BOOL(BOOLEAN)</strong> использует 1 байт для&nbsp;хранения значения. <strong>true</strong> соответствует 1, <strong>false</strong> соответствует 0.<br /><br /><a name="p-1044-26"></a>
<!--notypo--><div class="code"><code>'bool'=&gt;Array('byte'=&gt;<font color=green><b>1</b></font>,&nbsp;'true'=&gt;<font color=green><b>1</b></font>,&nbsp;'false'=&gt;<font color=green><b>0</b></font>),<br />
'boolean'=&gt;Array('byte'=&gt;<font color=green><b>1</b></font>,&nbsp;'true'=&gt;<font color=green><b>1</b></font>,&nbsp;'false'=&gt;<font color=green><b>0</b></font>),<font color=green><b></b></font></code></div><!--/notypo--><br /><div class="indent"></div><a name="h304-14"></a><h2>Символьные типы данных</h2><a name="h304-15"></a><h3>VARCHAR</h3>
<br /><a name="p-1044-27"></a>
<strong>byte</strong> — кол-во байт отведенных для&nbsp;хранения (можно задать меньше)<br />
<strong>min_byte</strong> — минимальное кол-во байт в&nbsp;которых может храниться поле (если длина равна 1)<br />
В&nbsp;MYSQL 5.0.3 и&nbsp;выше, <strong>VARCHAR</strong> может быть до&nbsp;65,535 символов!<br />
<strong>length</strong> — максимальная длина символов в&nbsp;поле<br /><br /><a name="p-1044-28"></a>
Тип&nbsp;поля <strong>VARCHAR, CHAR</strong> использует 256 байтов для&nbsp;хранения значения. Минимально &ndash; 2 байта. Максимальная длина символов в&nbsp;поле &ndash; 255.<br /><br /><a name="p-1044-29"></a>
<!--notypo--><div class="code"><code>'varchar'=&gt;Array('byte'=&gt;<font color=green><b>256</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'length'=&gt;<font color=green><b>255</b></font>),<br />
'char'=&gt;Array('byte'=&gt;<font color=green><b>256</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'length'=&gt;<font color=green><b>255</b></font>),<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-16"></a><h3>BLOB</h3>
<br /><a name="p-1044-30"></a>
Тип&nbsp;данных <strong>BLOB</strong> представляет собой двоичный объект большого размера, который может содержать переменное количество данных. Существуют 4 модификации этого типа &ndash; <strong>TINYBLOB</strong>, <strong>BLOB</strong>, <strong>MEDIUMBLOB</strong> и&nbsp;<strong>LONGBLOB</strong>, отличающиеся только максимальной длиной хранимых величин.<br /><br /><a name="p-1044-31"></a>
<strong>byte</strong> — кол-во байт для&nbsp;хранения поля<br />
<strong>min_byte</strong> — минимальное кол-во байт для&nbsp;хранения одного символа (если длина поля равна 1)<br />
<strong>length</strong> — максимальное количество символов в&nbsp;поле<br /><br /><a name="p-1044-32"></a>
Тип&nbsp;поля <strong>TINYBLOB</strong> использует от&nbsp;2 до&nbsp;256 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 255.<br /><br /><a name="p-1044-33"></a>
<!--notypo--><div class="code"><code>'tinyblob'=&gt;Array('byte'=&gt;<font color=green><b>256</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'length'=&gt;<font color=green><b>255</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1044-34"></a>
Тип&nbsp;поля <strong>BLOB</strong> использует от&nbsp;3 до&nbsp;65537 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 65535.<br /><br /><a name="p-1044-35"></a>
<!--notypo--><div class="code"><code>'blob'=&gt;Array('byte'=&gt;<font color=green><b>65537</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>3</b></font>,&nbsp;'length'=&gt;<font color=green><b>65535</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1044-36"></a>
Тип&nbsp;поля <strong>MEDIUMBLOB</strong> использует от&nbsp;4 до&nbsp;16777219 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 16777215.<br /><br /><a name="p-1044-37"></a>
<!--notypo--><div class="code"><code>'mediumblob'=&gt;Array('byte'=&gt;<font color=green><b>16777219</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>4</b></font>,&nbsp;'length'=&gt;<font color=green><b>16777215</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1044-38"></a>
Тип&nbsp;поля <strong>LONGBLOB</strong> использует от&nbsp;5 до&nbsp;4294967300 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 4294967296.<br /><br /><a name="p-1044-39"></a>
<!--notypo--><div class="code"><code>'longblob'=&gt;Array('byte'=&gt;<font color=green><b>4294967300</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>5</b></font>,&nbsp;'length'=&gt;<font color=green><b>4294967296</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-17"></a><h3>TEXT</h3>
<br /><a name="p-1044-40"></a>
Тип&nbsp;данных <strong>TEXT</strong> также имеет 4 модификации &ndash; <strong>TINYTEXT</strong>, <strong>TEXT</strong>, <strong>MEDIUMTEXT</strong> и&nbsp;<strong>LONGTEXT</strong>, соответствующие упомянутым четырем типам BLOB и&nbsp;имеющие те&nbsp;же максимальную длину и&nbsp;требования к&nbsp;объему памяти. Единственное различие между типами <strong>BLOB</strong> и&nbsp;<strong>TEXT</strong> состоит в&nbsp;том, что&nbsp;сортировка и&nbsp;сравнение данных выполняются с&nbsp;учетом регистра для&nbsp;величин <strong>BLOB</strong> и&nbsp;без учета регистра для&nbsp;величин <strong>TEXT</strong>. Другими словами, <strong>TEXT</strong> &ndash; это&nbsp;независимый от&nbsp;регистра <strong>BLOB</strong>.<br /><br /><a name="p-1044-41"></a>
<strong>byte</strong> — кол-во байт для&nbsp;хранения поля<br />
<strong>min_byte</strong> — минимальное кол-во байт для&nbsp;хранения одного символа (если длина поля равна 1)<br />
<strong>length</strong> — максимальное количество символов в&nbsp;поле<br /><br /><a name="p-1044-42"></a>
Тип&nbsp;поля <strong>TINYTEXT</strong> использует от&nbsp;2 до&nbsp;256 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 255.<br /><br /><a name="p-1044-43"></a>
<!--notypo--><div class="code"><code>'tinytext'=&gt;Array('byte'=&gt;<font color=green><b>256</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'length'=&gt;<font color=green><b>255</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1044-44"></a>
Тип&nbsp;поля <strong>TEXT</strong> использует от&nbsp;3 до&nbsp;65537 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 65535.<br /><br /><a name="p-1044-45"></a>
<!--notypo--><div class="code"><code>'text'=&gt;Array('byte'=&gt;<font color=green><b>65537</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>3</b></font>,&nbsp;'length'=&gt;<font color=green><b>65535</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1044-46"></a>
Тип&nbsp;поля <strong>MEDIUMTEXT</strong> использует от&nbsp;4 до&nbsp;16777218 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 16777215.<br /><br /><a name="p-1044-47"></a>
<!--notypo--><div class="code"><code>'mediumtext'=&gt;Array('byte'=&gt;<font color=green><b>16777218</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>4</b></font>,&nbsp;'length'=&gt;<font color=green><b>16777215</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1044-48"></a>
Тип&nbsp;поля <strong>LONGTEXT</strong> использует от&nbsp;5 до&nbsp;4294967300 байтов для&nbsp;хранения значения. Максимальное количество символов в&nbsp;поле &ndash; 4294967296.<br /><br /><a name="p-1044-49"></a>
<!--notypo--><div class="code"><code>'longtext'=&gt;Array('byte'=&gt;<font color=green><b>4294967300</b></font>,&nbsp;'min_byte'=&gt;<font color=green><b>5</b></font>,&nbsp;'length'=&gt;<font color=green><b>4294967296</b></font>),<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-18"></a><h3>ENUM</h3>
<br /><a name="p-1044-50"></a>
<strong>ENUM</strong> (перечисление) &ndash; это&nbsp;столбец, который может принимать значение из&nbsp;списка допустимых значений, явно перечисленных в&nbsp;спецификации столбца в&nbsp;момент создания таблицы.<br /><br /><a name="p-1044-51"></a>
<strong>byte</strong> — кол-во байт на&nbsp;хранение поля<br />
<strong>max_byte</strong> — максимальное кол-во байт, которое можно достигнуть при&nbsp;максимальном кол-ве элементов <br />
<strong>max_number_of_element</strong> — кол-во элементов, которое может содержать поле<br /><br /><a name="p-1044-52"></a>
Тип&nbsp;поля <strong>ENUM</strong> использует от&nbsp;1 до&nbsp;2 байтов для&nbsp;хранения значения. Количество элементов, которое может содержать поле &ndash; 65535.<br /><br /><a name="p-1044-53"></a>
<!--notypo--><div class="code"><code>'enum'=&gt;Array('byte'=&gt;<font color=green><b>1</b></font>,&nbsp;'max_byte'=&gt;<font color=green><b>2</b></font>,&nbsp;'max_number_of_element'=&gt;<font color=green><b>65535</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-19"></a><h3>SET</h3>
<br /><a name="p-1044-54"></a>
<strong>SET</strong> &ndash; это&nbsp;строковый тип, который может принимать ноль или&nbsp;более значений, каждое из&nbsp;которых должно быть выбрано из&nbsp;списка допустимых значений, определенных при&nbsp;создании таблицы. Элементы множества <strong>SET</strong> разделяются запятыми. Как&nbsp;следствие, сами элементы множества не&nbsp;могут содержать запятых.<br /><br /><a name="p-1044-55"></a>
<strong>byte</strong> — кол-во байт на&nbsp;хранение поля<br />
<strong>max_byte</strong> — максимальное кол-во байт, которое можно достигнуть при&nbsp;максимальном кол-ве элементов <br />
<strong>max_number_of_element</strong> — кол-во элементов, которое может содержать поле<br /><br /><a name="p-1044-56"></a>
Тип&nbsp;поля <strong>SET</strong> использует от&nbsp;1 до&nbsp;8 байт для&nbsp;хранения значения. Количество элементов, которое может содержать поле &ndash; 64.<br /><br /><a name="p-1044-57"></a>
<!--notypo--><div class="code"><code>'set'=&gt;Array('byte'=&gt;<font color=green><b>1</b></font>,&nbsp;'max_byte'=&gt;<font color=green><b>8</b></font>,&nbsp;'max_number_of_element'=&gt;<font color=green><b>64</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-20"></a><h2>Тип данных даты и&nbsp;времени</h2>
<br /><a name="p-1044-58"></a>
<strong>byte</strong> — кол-во байт для&nbsp;хранения значения поля<br />
<strong>mask</strong> — стандартная маска ввода значения<br />
<strong>min/max</strong> — минимальные максимальные значения дат&nbsp;которые сохраняют поля<br /><a name="h304-21"></a><h3>DATETIME</h3>
<br /><a name="p-1044-59"></a>
Тип&nbsp;данных <strong>DATETIME</strong> используется для&nbsp;величин, содержащих информацию как&nbsp;о&nbsp;дате, так&nbsp;и&nbsp;о времени. <!--notypo-->MySQL<!--/notypo--> извлекает и&nbsp;выводит величины <strong>DATETIME</strong> в&nbsp;формате 'YYYY-MM-DD HH:MM:SS'. Поддерживается диапазон величин от&nbsp;'<span class="nobr">1000&ndash;01&ndash;01</span> 00:00:00' до&nbsp;'<span class="nobr">9999&ndash;12&ndash;31</span> 23:59:59'. (&laquo;поддерживается&raquo; означает, что&nbsp;хотя величины с&nbsp;более ранними временными значениями, возможно, тоже будут работать, но&nbsp;нет гарантии того, что&nbsp;они будут правильно храниться и&nbsp;отображаться).<br /><br /><a name="p-1044-60"></a>
<!--notypo--><div class="code"><code>'datetime'=&gt;Array('byte'=&gt;<font color=green><b>8</b></font>,&nbsp;'mask'=&gt;'YYYY-MM-DD&nbsp;HH:&nbsp;MM:&nbsp;SS',&nbsp;'min'=&gt;'1000-01-01&nbsp;<font color=green><b>00</b></font>:<font color=green><b>00</b></font>:00',&nbsp;'max'=&gt;'9999-12-31&nbsp;<font color=green><b>23</b></font>:<font color=green><b>59</b></font>:59')<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-22"></a><h3>DATE</h3>
<br /><a name="p-1044-61"></a>
Тип&nbsp;<strong>DATE</strong> используется для&nbsp;величин с&nbsp;информацией только о&nbsp;дате, без&nbsp;части, содержащей время. <!--notypo-->MySQL<!--/notypo--> извлекает и&nbsp;выводит величины <strong>DATE</strong> в&nbsp;формате 'YYYY-MM-DD'. Поддерживается диапазон величин от&nbsp;'<span class="nobr">1000&ndash;01&ndash;01</span>' до&nbsp;'<span class="nobr">9999&ndash;12&ndash;31</span>'.<br /><br /><a name="p-1044-62"></a>
<!--notypo--><div class="code"><code>'date'=&gt;Array('byte'=&gt;<font color=green><b>3</b></font>,&nbsp;'mask'=&gt;'YYYY-MM-DD',&nbsp;'min'=&gt;'1000-01-01',&nbsp;'max'=&gt;'9999-12-31')<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-23"></a><h3>TIMESTAMP</h3>
<br /><a name="p-1044-63"></a>
Тип&nbsp;столбца <strong>TIMESTAMP</strong> обеспечивает тип&nbsp;представления данных, который можно использовать для&nbsp;автоматической записи текущих даты и&nbsp;времени при&nbsp;выполнении операций <strong>INSERT</strong> или&nbsp;<strong>UPDATE</strong>. При&nbsp;наличии нескольких столбцов типа <strong>TIMESTAMP</strong> только первый из&nbsp;них обновляется автоматически.<br /><br /><a name="p-1044-64"></a>
<!--notypo--><div class="code"><code>'timestamp'=&gt;Array('byte'=&gt;<font color=green><b>4</b></font>,&nbsp;'mask'=&gt;Array(<font color=green><b>14</b></font>=&gt;'YYYYMMDDHHMMSS',<font color=green><b>12</b></font>=&gt;'YYMMDDHHMMSS',<font color=green><b>10</b></font>=&gt;'YYMMDDHHMM',<font color=green><b>8</b></font>=&gt;'YYYYMMDD',<font color=green><b>6</b></font>=&gt;'YYMMDD',<font color=green><b>4</b></font>=&gt;'YYMM',<font color=green><b>2</b></font>=&gt;'YY'),&nbsp;'min'=&gt;<font color=green><b>1970</b></font>,&nbsp;'max'=&gt;<font color=green><b>2036</b></font>&nbsp;)<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-24"></a><h3>TIME</h3>
<br /><a name="p-1044-65"></a>
<!--notypo-->MySQL<!--/notypo--> извлекает и&nbsp;выводит величины типа <strong>TIME</strong> в&nbsp;формате 'HH:MM:SS' (или в&nbsp;формате 'HHH:MM:SS' для&nbsp;больших значений часов). Величины <strong>TIME</strong> могут изменяться в&nbsp;пределах от&nbsp;'-838:59:59' до&nbsp;'838:59:59'. <br /><br /><a name="p-1044-66"></a>
<!--notypo--><div class="code"><code>'time'=&gt;Array('byte'=&gt;<font color=green><b>3</b></font>,&nbsp;'min'=&gt;'-838:<font color=green><b>59</b></font>:59',&nbsp;'max'=&gt;'838:<font color=green><b>59</b></font>:59')<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h304-25"></a><h3>YEAR</h3>
<br /><a name="p-1044-67"></a>
Тип&nbsp;<strong>YEAR</strong> &ndash; это&nbsp;однобайтный тип&nbsp;данных для&nbsp;представления значений года.<br /><br /><a name="p-1044-68"></a>
<!--notypo-->MySQL<!--/notypo--> извлекает и&nbsp;выводит величины <strong>YEAR</strong> в&nbsp;формате YYYY. Диапазон возможных значений &ndash; от&nbsp;1901 до&nbsp;2155.<br /><br /><a name="p-1044-69"></a>
<!--notypo--><div class="code"><code>'year'=&gt;Array('byte'=&gt;<font color=green><b>1</b></font>,&nbsp;'min'=&gt;<font color=green><b>1901</b></font>,&nbsp;'max'=&gt;<font color=green><b>2155</b></font>)<font color=green><b></b></font></code></div><!--/notypo--><br />   <script language="JavaScript" type="text/javascript">
   var dbclick = "page";
  </script>
<br style="clear:both" />&nbsp;
</div>

<hr><hr>

<br /><a name="h177-5"></a><a name="h177-6"></a><a name="h177-7"></a><a name="h177-8"></a><h2>7. Построение интерфейса для&nbsp;добавления информации</h2>
<br /><a name="p71139-43"></a>




Итак, у&nbsp;нас есть какая-то таблица в&nbsp;базе данных. Чтобы построить интерфейс для&nbsp;добавления информации в&nbsp;эту таблицу, нужно ее&nbsp;структуру (т.е. набор ее&nbsp;полей) отобразить в&nbsp;html-форму.<br /><br /><a name="p71139-44"></a>
Разобьем эту&nbsp;задачу на&nbsp;следующие подзадачи:<br /><ul><li> установка соединения с&nbsp;БД;
</li><li> выбор рабочей БД;
</li><li> получение списка полей таблицы;
</li><li> отображение полей в&nbsp;html-форму.</li></ul>
<br /><a name="p71139-45"></a>
После этого данные, введенные в&nbsp;форму, нужно записать в&nbsp;базу данных.<br /><br /><a name="p71139-46"></a>
Рассмотрим все&nbsp;эти задачи по&nbsp;порядку.<br /><a name="h177-9"></a><h2>8. Установка соединения</h2>
<br /><a name="p71139-47"></a>
Итак, первое, что&nbsp;нужно сделать, &ndash; это&nbsp;установить соединение с&nbsp;базой данных.<br /><br /><a name="p71139-48"></a>
Воспользуемся функцией Mysql_connect.<br /><br /><a name="p71139-49"></a>
Синтаксис Mysql_connect<br /><br /><a name="p71139-50"></a>
<!--notypo--><div class="code"><code>ресурс&nbsp;Mysql_connect&nbsp;(&nbsp;[строка&nbsp;server<br />
[,&nbsp;строка&nbsp;username&nbsp;[,&nbsp;строка&nbsp;<font color=blue>password</font><br />
[,&nbsp;логическое&nbsp;new_link<br />
[,&nbsp;целое&nbsp;client_flags]]]]])<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-51"></a>
Данная функция устанавливает соединение с&nbsp;сервером Mysql и&nbsp;возвращает указатель на&nbsp;это соединение или&nbsp;FALSE в&nbsp;случае неудачи. <br /><br /><a name="p71139-52"></a>
Для&nbsp;отсутствующих параметров устанавливаются следующие значения по&nbsp;умолчанию:<br />
server = 'localhost:3306'<br />
username = имя&nbsp;пользователя владельца процесса сервера<br />
password = пустой пароль<br /><br /><a name="p71139-53"></a>
Если функция вызывается дважды с&nbsp;одними и&nbsp;теми же&nbsp;параметрами, то&nbsp;новое соединение не&nbsp;устанавливается, а&nbsp;возвращается ссылка на&nbsp;старое соединение.<br /><br /><a name="p71139-54"></a>
Чтобы этого избежать, используют параметр new_link, который заставляет в&nbsp;любом случае открыть еще&nbsp;одно соединение.<br /><br /><a name="p71139-55"></a>
Параметр client_flags &ndash; это&nbsp;комбинация следующих констант:<br />
<!--notypo--><div class="code"><code>MYSQL_CLIENT_COMPRESS&nbsp;(использовать&nbsp;протокол&nbsp;сжатия),<br />
MYSQL_CLIENT_IGNORE_SPACE&nbsp;(позволяет&nbsp;вставлять&nbsp;пробелы&nbsp;после&nbsp;имен&nbsp;функций),&nbsp;MYSQL_CLIENT_INTERACTIVE&nbsp;(ждать&nbsp;interactive_timeout&nbsp;секунд&nbsp;-&nbsp;вместо&nbsp;wait_timeout&nbsp;-&nbsp;до&nbsp;закрытия&nbsp;соединения).<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-56"></a>
Параметр new_link появился в&nbsp;PHP 4.2.0, а&nbsp;параметр client_flags &ndash; в&nbsp;PHP 4.3.0.<br /><br /><a name="p71139-57"></a>
Соединение с&nbsp;сервером закрывается при&nbsp;завершении исполнения скрипта, если оно&nbsp;до&nbsp;этого не&nbsp;было закрыто с&nbsp;помощью функции Mysql_close().<br /><br /><a name="p71139-58"></a>
Итак, устанавливаем соединение с&nbsp;базой данных на&nbsp;локальном сервере для&nbsp;пользователя nina с&nbsp;паролем &#147;123&#148;:<br /><br /><a name="p71139-59"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?<br />$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(<br /></span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"nina"</span><span style="color: #007700">,</span><span style="color: #DD0000">"123"</span><span style="color: #007700">)<br />or&nbsp;die(</span><span style="color: #DD0000">"Невозможно&nbsp;установить<br />соединение:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">Mysql_error</span><span style="color: #007700">());<br />echo&nbsp;</span><span style="color: #DD0000">"Соединение&nbsp;установлено"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">Mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p71139-60"></a>
Действие Mysql_connect равносильно команде<br /><br /><a name="p71139-61"></a>
<!--notypo--><div class="code"><code>shell&gt;Mysql&nbsp;-u&nbsp;nina&nbsp;-p123</code></div><!--/notypo--><br /><a name="h177-10"></a><h2>9. Выбор базы данных</h2>
<br /><a name="p71139-62"></a>
После установки соединения нужно выбрать базу данных, с&nbsp;которой будем работать. Наши данные хранятся в&nbsp;базе данных book. В&nbsp;Mysql выбор базы данных осуществляется с&nbsp;помощью команды use:<br /><br /><a name="p71139-63"></a>
<!--notypo--><div class="code"><code>Mysql&gt;<font color=blue>use</font>&nbsp;book;<font color=green><b></b></font></code></div><!--/notypo--><br />
В&nbsp;PHP для&nbsp;этого существует функция Mysql_select_db.<br /><br /><a name="p71139-64"></a>
Синтаксис Mysql_select_db:<br /><br /><a name="p71139-65"></a>
логическое <br />
<!--notypo--><div class="code"><code>Mysql_select_db&nbsp;(строка&nbsp;database_name&nbsp;[,&nbsp;ресурс&nbsp;link_identifier])<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-66"></a>
Эта&nbsp;функция возвращает TRUE в&nbsp;случае успешного выбора базы данных и&nbsp;FALSE<br /><ul><li> в&nbsp;противном случае.</li></ul>
<br /><a name="p71139-67"></a>
Сделаем базу данных book рабочей:<br /><br /><a name="p71139-68"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?<br />$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(<br /></span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,</span><span style="color: #DD0000">"nina"</span><span style="color: #007700">,</span><span style="color: #DD0000">"123"</span><span style="color: #007700">)<br />or&nbsp;die(</span><span style="color: #DD0000">"Невозможно&nbsp;установить<br />соединение:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">Mysql_error</span><span style="color: #007700">());<br />echo&nbsp;</span><span style="color: #DD0000">"Соединение&nbsp;установлено"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">"book"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><a name="h177-11"></a><h2>10. Получение списка полей таблицы</h2>
<br /><a name="p71139-69"></a>
Теперь можно заняться собственно решением задачи. Как&nbsp;получить список полей таблицы? Очень просто. В&nbsp;PHP и&nbsp;на этот случай есть своя команда &ndash; Mysql_list_fields.<br /><a name="h177-12"></a><h3>10.1. Синтаксис Mysql_list_fields</h3>
<br /><a name="p71139-70"></a>
<!--notypo--><div class="code"><code>ресурс&nbsp;Mysql_list_fields&nbsp;(<br />
строка&nbsp;database_name,<br />
строка&nbsp;table_name<br />
[,&nbsp;ресурс&nbsp;link_identifier])<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-71"></a>
Эта&nbsp;функция возвращает список полей в&nbsp;таблице table_name в&nbsp;базе данных database_name. Получается, что&nbsp;выбирать базу данных нам&nbsp;было необязательно, но&nbsp;это пригодится позже. Как&nbsp;можно заметить, результат работы этой функции &ndash; переменная типа ресурс. То&nbsp;есть это&nbsp;не&nbsp;совсем то, что&nbsp;мы&nbsp;хотели получить. Это&nbsp;ссылка, которую можно использовать для&nbsp;получения информации о&nbsp;полях таблицы, включая их&nbsp;названия, типы и&nbsp;флаги.<br /><br /><a name="p71139-72"></a>
Функция Mysql_field_name возвращает имя&nbsp;поля, полученного в&nbsp;результате выполнения запроса. Функция Mysql_field_len возвращает длину поля. Функция Mysql_field_type возвращает тип&nbsp;поля, а&nbsp;функция Mysql_field_flags возвращает список флагов поля, записанных через пробел. Типы поля могут быть int, real, string, blob и&nbsp;т.д. Флаги могут быть not_null, primary_key, unique_key, blob,<br />
auto_increment и&nbsp;т.д.<br /><br /><a name="p71139-73"></a>
Синтаксис у&nbsp;всех этих команд одинаков:<br /><br /><a name="p71139-74"></a>
<!--notypo--><div class="code"><code>строка&nbsp;Mysql_field_name&nbsp;(ресурс&nbsp;result,&nbsp;целое&nbsp;field_offset)<br />
строка&nbsp;Mysql_field_type&nbsp;(&nbsp;ресурс&nbsp;result,&nbsp;целое&nbsp;field_offset)<br />
строка&nbsp;Mysql_field_flags&nbsp;(&nbsp;ресурс&nbsp;result,&nbsp;целое&nbsp;field_offset)<br />
строка&nbsp;Mysql_field_len&nbsp;(&nbsp;ресурс&nbsp;result,&nbsp;целое&nbsp;field_offset)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-75"></a>
Здесь result &ndash; это&nbsp;идентификатор результата запроса (например, запроса, отправленного функциями Mysql_list_fields или&nbsp;Mysql_query (о ней&nbsp;будет рассказано позднее)), а&nbsp;field_offset &ndash; порядковый номер поля в&nbsp;результате.<br /><br /><a name="p71139-76"></a>
Вообще говоря, то, что&nbsp;возвращают функции типа Mysql_list_fields или&nbsp;Mysql_query, представляет собой таблицу, а&nbsp;точнее, указатель на&nbsp;нее. Чтобы получить из&nbsp;этой таблицы конкретные значения, нужно задействовать специальные функции, которые построчно читают эту&nbsp;таблицу. К&nbsp;таким функциям и&nbsp;относятся Mysql_field_name и&nbsp;т.п. Чтобы перебрать все&nbsp;строки в&nbsp;таблице результата выполнения запроса, нужно знать число строк в&nbsp;этой таблице. Команда Mysql_num_rows(ресурс result) возвращает число строк во&nbsp;множестве результатов<br />
result.<br /><br /><a name="p71139-77"></a>
А&nbsp;теперь попробуем получить список полей таблицы Artifacts (коллекция экспонатов).<br /><br /><a name="p71139-78"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?<br />$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(<br /></span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,</span><span style="color: #DD0000">"nina"</span><span style="color: #007700">,</span><span style="color: #DD0000">"123"</span><span style="color: #007700">)<br />or&nbsp;die(</span><span style="color: #DD0000">"Невозможно&nbsp;установить<br />соединение:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">Mysql_error</span><span style="color: #007700">());<br />echo&nbsp;</span><span style="color: #DD0000">"Соединение&nbsp;установлено"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">"book"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$list_f&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_list_fields&nbsp;</span><span style="color: #007700">(<br /></span><span style="color: #DD0000">"book"</span><span style="color: #007700">,</span><span style="color: #DD0000">"Artifacts"</span><span style="color: #007700">,</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$n&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_num_fields</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">);<br />for(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">$n</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++){<br /></span><span style="color: #0000BB">$type&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_type</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$name_f&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$len&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_len</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$flags_str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_flags&nbsp;</span><span style="color: #007700">(<br /></span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;br&gt;Имя&nbsp;поля:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$name_f</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;br&gt;Тип&nbsp;поля:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;br&gt;Длина&nbsp;поля:&nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$len</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;br&gt;Строка&nbsp;флагов&nbsp;поля:&nbsp;"</span><span style="color: #007700">.<br /></span><span style="color: #0000BB">$flags_str&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"&lt;hr&gt;"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p71139-79"></a>
В&nbsp;результате должно получиться примерно вот&nbsp;что (если в&nbsp;таблице всего два&nbsp;поля, конечно):<br /><br /><a name="p71139-80"></a>
Имя&nbsp;поля: id<br />
Тип&nbsp;поля: int<br />
Длина поля: 11<br />
Строка флагов поля:<br />
not_null primary_key auto_increment<br />
Имя&nbsp;поля: title<br />
Тип&nbsp;поля: string<br />
Длина поля: 255<br />
Строка флагов поля:<br />
Отображение списка полей в&nbsp;html-форму<br /><br /><a name="p71139-81"></a>
Теперь немножко подкорректируем предыдущий пример. Будем не&nbsp;просто выводить информацию о&nbsp;поле, а&nbsp;отображать его&nbsp;в&nbsp;подходящий элемент html- формы. Так, элементы типа BLOB переведем в&nbsp;textarea (заметим, что&nbsp;поле description, которое мы&nbsp;создавали с&nbsp;типом TEXT, отображается как&nbsp;имеющее тип&nbsp;BLOB), числа и&nbsp;строки отобразим в&nbsp;текстовые строки ввода &lt;input type=text&gt;, а&nbsp;элемент, имеющий метку автоинкремента, вообще не&nbsp;будем отображать, поскольку его&nbsp;значение устанавливается автоматически.<br /><br /><a name="p71139-82"></a>
Все&nbsp;это решается довольно просто, за&nbsp;исключением выделения из&nbsp;списка флагов флага auto_increment. Для&nbsp;этого нужно воспользоваться функцией explode.<br /><br /><a name="p71139-83"></a>
Синтаксис explode:<br /><br /><a name="p71139-84"></a>
<!--notypo--><div class="code"><code>массив&nbsp;explode(&nbsp;строка&nbsp;separator,&nbsp;строка&nbsp;string&nbsp;[,&nbsp;<font color=blue>int</font>&nbsp;<font color=blue>limit</font>])<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-85"></a>
Эта&nbsp;функция разбивает строку string на&nbsp;части с&nbsp;помощью разделителя separator и&nbsp;возвращает массив полученных строк.<br /><br /><a name="p71139-86"></a>
В&nbsp;нашем случае в&nbsp;качестве разделителя нужно взять пробел &#147; ", а&nbsp;в качестве исходной строки для&nbsp;разбиения &ndash; строку флагов поля.<br /><br /><a name="p71139-87"></a>
Итак, создадим форму для&nbsp;ввода данных в&nbsp;таблицу Artifacts:<br /><br /><a name="p71139-88"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?<br />$conn</span><span style="color: #007700">=</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,</span><span style="color: #DD0000">"nina"</span><span style="color: #007700">,</span><span style="color: #DD0000">"123"</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;устанавливаем&nbsp;соединение<br /></span><span style="color: #0000BB">$database&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"book"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$table_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Artifacts"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;выбираем&nbsp;базу&nbsp;данных&nbsp;для<br />//&nbsp;работы<br /></span><span style="color: #0000BB">$list_f&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_list_fields</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">,</span><span style="color: #0000BB">$table_name</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;получаем&nbsp;список&nbsp;полей&nbsp;в&nbsp;базе<br /></span><span style="color: #0000BB">$n&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_num_fields</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;число&nbsp;строк&nbsp;в&nbsp;результате<br />//&nbsp;предыдущего&nbsp;запроса&nbsp;(т.е.&nbsp;сколько&nbsp;всего<br />//&nbsp;полей&nbsp;в&nbsp;таблице&nbsp;Artifacts)<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"&lt;form&nbsp;method=post&nbsp;action=insert.php&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;создаем&nbsp;форму&nbsp;для&nbsp;ввода&nbsp;данных<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"&amp;nbsp;&lt;TABLE&nbsp;BORDER=0&nbsp;CELLSPACING=0&nbsp;width=50%&nbsp;&gt;&lt;tr&gt;<br />&lt;TD&nbsp;BGCOLOR='#005533'&nbsp;align=center&gt;&lt;font&nbsp;color='#FFFFFF'&gt;<br />&lt;b&gt;&nbsp;Add&nbsp;new&nbsp;row&nbsp;in<br />$table_name&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/TABLE&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;table&nbsp;border=0&nbsp;CELLSPACING=1&nbsp;cellpadding=0&nbsp;width=50%&nbsp;&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;для&nbsp;каждого&nbsp;поля&nbsp;получаем&nbsp;его&nbsp;имя,&nbsp;тип,&nbsp;длину&nbsp;и&nbsp;флаги<br /></span><span style="color: #007700">for(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">$n</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++){<br /></span><span style="color: #0000BB">$type&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_type</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$name_f&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_name&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$len&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_len</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$flags_str&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_flags&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;из&nbsp;строки&nbsp;флагов&nbsp;делаем&nbsp;массив,<br />//&nbsp;где&nbsp;каждый&nbsp;элемент&nbsp;массива&nbsp;-&nbsp;флаг&nbsp;поля<br /></span><span style="color: #0000BB">$flags&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$flags_str</span><span style="color: #007700">);<br />foreach&nbsp;(</span><span style="color: #0000BB">$flags&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$f</span><span style="color: #007700">){<br />if&nbsp;(</span><span style="color: #0000BB">$f&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #DD0000">'auto_increment'</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$name_f</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//&nbsp;запоминаем&nbsp;имя&nbsp;автоинкремента<br /></span><span style="color: #007700">}<br /></span><span style="color: #FF8000">/*&nbsp;для&nbsp;каждого&nbsp;поля,&nbsp;не&nbsp;являющегося&nbsp;автоинкрементом,&nbsp;в<br />зависимости&nbsp;от&nbsp;его&nbsp;типа&nbsp;выводим&nbsp;подходящий&nbsp;элемент&nbsp;формы&nbsp;*/<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">&lt;&gt;&nbsp;</span><span style="color: #0000BB">$name_f</span><span style="color: #007700">){<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;tr&gt;&lt;td&nbsp;align=right&nbsp;bgcolor='#C2E3B6'&gt;&lt;font&nbsp;size=2&gt;<br />&lt;b&gt;&amp;nbsp;"</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$name_f&nbsp;</span><span style="color: #007700">.</span><span style="color: #DD0000">"&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;"</span><span style="color: #007700">;<br />switch&nbsp;(</span><span style="color: #0000BB">$type</span><span style="color: #007700">){<br />case&nbsp;</span><span style="color: #DD0000">"string"</span><span style="color: #007700">:<br /></span><span style="color: #0000BB">$w&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$len</span><span style="color: #007700">/</span><span style="color: #0000BB">5</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;td&gt;&lt;input&nbsp;type=text&nbsp;name=\"$name_f\"<br />size&nbsp;=&nbsp;$w&nbsp;&gt;&lt;/td&gt;"</span><span style="color: #007700">;<br />break;<br />case&nbsp;</span><span style="color: #DD0000">"int"</span><span style="color: #007700">:<br /></span><span style="color: #0000BB">$w&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$len</span><span style="color: #007700">/</span><span style="color: #0000BB">4</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;td&gt;&lt;input&nbsp;type=text&nbsp;name=\"$name_f\"<br />size&nbsp;=&nbsp;$w&nbsp;&gt;&lt;/td&gt;"</span><span style="color: #007700">;<br />break;<br />case&nbsp;</span><span style="color: #DD0000">"blob"</span><span style="color: #007700">:<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;td&gt;&lt;textarea&nbsp;rows=6&nbsp;cols=60<br />name=\"$name_f\"&gt;&lt;/textarea&gt;&lt;/td&gt;"</span><span style="color: #007700">;<br />break;<br />}<br />}<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/tr&gt;"</span><span style="color: #007700">;<br />}<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/table&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;input&nbsp;type=submit&nbsp;name='add'&nbsp;value='Add'&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/form&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p71139-89"></a>
<strong>Листинг 11.0.1. Форма для&nbsp;ввода данных в&nbsp;таблицу Artifacts</strong><br /><a name="h177-13"></a><h2>11. Запись данных в&nbsp;базу данных</h2>
<br /><a name="p71139-90"></a>
Итак, форма создана. Теперь нужно сделать самое главное &ndash; отправить данные из&nbsp;этой формы в&nbsp;нашу базу данных. Как&nbsp;вы&nbsp;уже знаете, для&nbsp;того чтобы записать данные в&nbsp;таблицу, используется команда INSERT языка SQL. Например:<br /><br /><a name="p71139-91"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;Artifacts<br />
<font color=blue>SET</font>&nbsp;title='Петров';<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-92"></a>
Возникает вопрос, как&nbsp;можно воспользоваться такой командой (или любой другой командой SQL) в&nbsp;PHP скрипте. Для&nbsp;этого существует функция Mysql_query().<br /><a name="h177-14"></a><h3>11.1. Синтаксис Mysql_query</h3>
<br /><a name="p71139-93"></a>
ресурс <br /><br /><a name="p71139-94"></a>
<!--notypo--><div class="code"><code>Mysql_query&nbsp;(&nbsp;строка&nbsp;query&nbsp;[,&nbsp;ресурс&nbsp;link_identifier])<br />
Mysql_query()&nbsp;посылает&nbsp;SQL-запрос&nbsp;активной&nbsp;базе&nbsp;данных&nbsp;Mysql&nbsp;сервера,&nbsp;который&nbsp;определяется&nbsp;с&nbsp;помощью&nbsp;указателя&nbsp;link_identifier&nbsp;(это&nbsp;ссылка&nbsp;на&nbsp;какое-то&nbsp;соединение&nbsp;с&nbsp;сервером&nbsp;Mysql).&nbsp;Если&nbsp;параметр&nbsp;link_identifier&nbsp;опущен,&nbsp;используется&nbsp;последнее&nbsp;открытое&nbsp;соединение.<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p71139-95"></a>
Если открытые соединения отсутствуют, функция пытается соединиться с&nbsp;СУБД, аналогично функции Mysql_connect() без&nbsp;параметров. Результат запроса буферизируется.<br /><br /><a name="p71139-96"></a>
Замечание: строка запроса НЕ&nbsp;должна заканчиваться точкой с&nbsp;запятой.<br /><br /><a name="p71139-97"></a>
Только для&nbsp;запросов SELECT, SHOW, EXPLAIN, DESCRIBE, Mysql_query() возвращает указатель на&nbsp;результат запроса, или&nbsp;FALSE, если запрос не&nbsp;был выполнен. В&nbsp;остальных случаях Mysql_query() возвращает TRUE, если запрос выполнен успешно, и&nbsp;FALSE &ndash; в&nbsp;случае ошибки. Значение, не&nbsp;равное FALSE, говорит о&nbsp;том, что&nbsp;запрос был&nbsp;выполнен успешно. Оно&nbsp;не&nbsp;говорит о&nbsp;количестве затронутых или&nbsp;возвращенных рядов. Вполне возможна ситуация, когда успешный запрос не&nbsp;затронет ни&nbsp;одного ряда. Mysql_query() также считается ошибочным и&nbsp;вернет FALSE, если у&nbsp;пользователя недостаточно прав для&nbsp;работы с&nbsp;указанной в&nbsp;запросе таблицей.<br /><br /><a name="p71139-98"></a>
Итак, теперь мы&nbsp;знаем, как&nbsp;отправить запрос на&nbsp;вставку строк в&nbsp;базу данных.<br /><br /><a name="p71139-99"></a>
Заметим, что&nbsp;в&nbsp;предыдущем примере элементы формы мы&nbsp;назвали именами полей таблицы. Поэтому они&nbsp;будут доступны в&nbsp;скрипте insert.php, обрабатывающем данные формы, как&nbsp;переменные вида<br /><br /><a name="p71139-100"></a>
<strong>$_POST['имя_поля'].</strong><br /><br /><a name="p71139-101"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?<br />$conn</span><span style="color: #007700">=</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">"localhost"</span><span style="color: #007700">,</span><span style="color: #DD0000">"nina"</span><span style="color: #007700">,</span><span style="color: #DD0000">"123"</span><span style="color: #007700">);</span><span style="color: #FF8000">//&nbsp;устанавливаем<br />//&nbsp;соединение<br /></span><span style="color: #0000BB">$database&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"book"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$table_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"Artifacts"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;выбираем&nbsp;базу&nbsp;данных<br /></span><span style="color: #0000BB">$list_f&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_list_fields</span><span style="color: #007700">(</span><span style="color: #0000BB">$database</span><span style="color: #007700">,</span><span style="color: #0000BB">$table_name</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;получаем&nbsp;список&nbsp;полей&nbsp;в&nbsp;базе<br /></span><span style="color: #0000BB">$n&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_num_fields</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;число&nbsp;строк&nbsp;в&nbsp;результате<br />//&nbsp;предыдущего&nbsp;запроса<br />//&nbsp;составим&nbsp;один&nbsp;запрос&nbsp;сразу&nbsp;для&nbsp;всех&nbsp;полей&nbsp;таблицы<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;$table_name&nbsp;SET&nbsp;"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;начинаем&nbsp;создавать<br />//&nbsp;запрос,&nbsp;перебираем&nbsp;все&nbsp;поля&nbsp;таблицы<br /></span><span style="color: #007700">for(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">$n</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++){<br /></span><span style="color: #0000BB">$name_f&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_field_name&nbsp;</span><span style="color: #007700">(</span><span style="color: #0000BB">$list_f</span><span style="color: #007700">,</span><span style="color: #0000BB">$i</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;вычисляем&nbsp;имя&nbsp;поля<br /></span><span style="color: #0000BB">$value&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">$name_f</span><span style="color: #007700">];&nbsp;</span><span style="color: #FF8000">//&nbsp;вычисляем&nbsp;значение&nbsp;поля<br /></span><span style="color: #0000BB">$j&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">+&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$name_f</span><span style="color: #007700">.</span><span style="color: #DD0000">"&nbsp;=&nbsp;'$value'"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;дописываем&nbsp;в<br />//&nbsp;строку&nbsp;$sql&nbsp;пару&nbsp;имя=значение<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$j&nbsp;</span><span style="color: #007700">&lt;&gt;&nbsp;</span><span style="color: #0000BB">$n</span><span style="color: #007700">)&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">",&nbsp;"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;если&nbsp;поле&nbsp;не<br />//&nbsp;последнее&nbsp;в&nbsp;списке,&nbsp;то&nbsp;ставим&nbsp;запятую<br /></span><span style="color: #007700">}<br /></span><span style="color: #FF8000">//&nbsp;перед&nbsp;тем&nbsp;как&nbsp;записывать&nbsp;что-то&nbsp;в&nbsp;базу,<br />//&nbsp;можно&nbsp;посмотреть,&nbsp;какой&nbsp;запрос&nbsp;получился<br />//echo&nbsp;$sql;<br /></span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">,</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);&nbsp;</span><span style="color: #FF8000">//&nbsp;отправляем&nbsp;запрос<br />//&nbsp;выводим&nbsp;сообщение&nbsp;успешно&nbsp;ли&nbsp;выполнен&nbsp;запрос<br /></span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&nbsp;Can't&nbsp;add&nbsp;($table_name)&nbsp;"</span><span style="color: #007700">;<br />else&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Success!&lt;br&gt;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p71139-102"></a>
<strong>Листинг 11.0.2. insert.php</strong><br /><br /><a name="p71139-103"></a>
Итак, задачу добавления данных с&nbsp;помощью web-интерфейса мы&nbsp;решили. Однако тут&nbsp;есть одна тонкость. При&nbsp;решении мы&nbsp;не учитывали тот&nbsp;факт, что&nbsp;значения некоторых полей (author, photo) должны браться из&nbsp;других таблиц (Persons, Images). Поскольку Mysql с&nbsp;внешними ключами не&nbsp;работает, этот момент остается на&nbsp;совести разработчиков системы, т.е. на&nbsp;нашей совести. Нужно дописать программу таким образом, чтобы была возможность вводить в&nbsp;такие поля правильные значения. Но&nbsp;мы делать этого не&nbsp;будем, поскольку задача лекции состоит в&nbsp;том, чтобы познакомить читателя с&nbsp;элементами технологии, а&nbsp;не в&nbsp;том, чтобы создать работающую систему. Кроме того, имеющихся у&nbsp;читателя знаний вполне достаточно, чтобы решить эту&nbsp;проблему самостоятельно. Мы&nbsp;же обратимся к&nbsp;другой задаче &ndash; отображение данных, хранящихся в&nbsp;базе данных СУБД Mysql.<br /><a name="h177-15"></a>


           <h2>12. Отображение данных, хранящихся в Mysql</h2>

Чтобы отобразить какие-то данные в&nbsp;браузер с&nbsp;помощью PHP, нужно сначала получить эти&nbsp;данные в&nbsp;виде переменных PHP. При&nbsp;работе с&nbsp;Mysql без&nbsp;посредника (такого, как&nbsp;PHP) выборка данных производится с&nbsp;помощью команды SELECT языка SQL:<br /><br /><a name="p-2885-2"></a>
<!--notypo--><div class="code"><code>Mysql&gt;&nbsp;<font color=blue>SELECT</font>&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;Artifacts;<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-2885-3"></a>
В&nbsp;предыдущей главе мы&nbsp;говорили, что&nbsp;любой запрос, в&nbsp;том числе и&nbsp;на выборку, можно отправить на&nbsp;сервер с&nbsp;помощью функции Mysql_query(); Там&nbsp;у&nbsp;нас стояла немного другая задача &ndash; получить данные из&nbsp;формы и&nbsp;отправить их&nbsp;с помощью запроса на&nbsp;вставку в&nbsp;базу данных. Результатом работы Mysql_query() там&nbsp;могло быть только одно из&nbsp;выражений, TRUE или&nbsp;FALSE. Теперь же&nbsp;требуется отправить запрос на&nbsp;выбор всех полей, а&nbsp;результат отобразить в&nbsp;браузере. И&nbsp;здесь результат &ndash; это&nbsp;целая таблица значений, а&nbsp;точнее, указатель на&nbsp;эту таблицу. Так&nbsp;что нужны какие-то аналоги функции Mysql_field_name(), только чтобы они&nbsp;извлекали из&nbsp;результата запроса не&nbsp;имя, а&nbsp;значение поля. Таких функций в&nbsp;PHP несколько.<br /><br /><a name="p-2885-4"></a>
Наиболее популярные &ndash; Mysql_result() и&nbsp;Mysql_fetch_array().<br /><br /><a name="p-2885-5"></a>
<strong>Синтаксис Mysql_result</strong><br /><br /><a name="p-2885-6"></a>
смешанное <!--notypo--><div class="code"><code>Mysql_result&nbsp;(ресурс&nbsp;result,&nbsp;целое&nbsp;<font color=blue>row</font>&nbsp;[,&nbsp;смешанное&nbsp;field])<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-2885-7"></a>
Mysql_result() возвращает значение одной ячейки результата запроса. Аргумент field может быть порядковым номером поля в&nbsp;результате, именем поля или&nbsp;именем поля с&nbsp;именем таблицы через точку tablename.fieldname. Если для&nbsp;имени поля в&nbsp;запросе применялся алиас ('select foo&nbsp;as&nbsp;bar from...'), используйте его&nbsp;вместо реального имени поля.<br /><br /><a name="p-2885-8"></a>
Работая с&nbsp;большими результатами запросов, следует задействовать одну из&nbsp;функций, обрабатывающих сразу целый ряд&nbsp;результата (например, Mysql_fetch_row(), Mysql_fetch_array() и&nbsp;т.д.). Так&nbsp;как эти&nbsp;функции возвращают значение нескольких ячеек сразу, они&nbsp;НАМНОГО быстрее Mysql_result(). Кроме того, нужно учесть, что&nbsp;указание численного смещения (номера поля) работает намного быстрее, чем&nbsp;указание колонки или&nbsp;колонки и&nbsp;таблицы через точку.<br /><br /><a name="p-2885-9"></a>
Вызовы функции Mysql_result() не&nbsp;должны смешиваться с&nbsp;другими функциями, работающими с&nbsp;результатом запроса.<br /><br /><a name="p-2885-10"></a>
Синтаксис Mysql_fetch_array<br /><br /><a name="p-2885-11"></a>
массив <!--notypo--><div class="code"><code>Mysql_fetch_array&nbsp;(&nbsp;ресурс&nbsp;result&nbsp;[,&nbsp;целое&nbsp;result_type])<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-2885-12"></a>
Эта&nbsp;функция обрабатывает ряд&nbsp;результата запроса, возвращая массив (ассоциативный, численный или&nbsp;оба) с&nbsp;обработанным рядом результата запроса, или&nbsp;FALSE, если рядов больше нет.<br /><br /><a name="p-2885-13"></a>
Mysql_fetch_array() &ndash; это&nbsp;расширенная версия функции Mysql_fetch_row(). Помимо хранения значений в&nbsp;массиве с&nbsp;численными индексами, функция возвращает значения в&nbsp;массиве с&nbsp;индексами по&nbsp;названию колонок.<br /><br /><a name="p-2885-14"></a>
Если несколько колонок в&nbsp;результате будут иметь одинаковые названия, будет возвращена последняя колонка. Чтобы получить доступ к&nbsp;первым, следует использовать численные индексы массива или&nbsp;алиасы в&nbsp;запросе. В&nbsp;случае алиасов именно их&nbsp;вы не&nbsp;сможете использовать настоящие имена колонок, как, например, не&nbsp;сможете использовать &#147;photo&#148; в&nbsp;описанном ниже примере. <br /><br /><a name="p-2885-15"></a>
<!--notypo--><div class="code"><code><font color=blue>select</font>&nbsp;Artifacts.photo&nbsp;<font color=blue>as</font>&nbsp;art_image,<br />
Persons.photo&nbsp;<font color=blue>as</font>&nbsp;pers_image<br />
<font color=blue>from</font>&nbsp;Artifacts,&nbsp;Persons</code></div><!--/notypo--><br /><br /><a name="p-2885-16"></a>
<strong>Пример 11.1. Запрос с&nbsp;дублирующимися именами колонок</strong><br /><br /><a name="p-2885-17"></a>
Важно заметить, что&nbsp;Mysql_fetch_array() работает НЕ&nbsp;медленнее, чем&nbsp;Mysql_fetch_row(), и&nbsp;предоставляет более удобный доступ к&nbsp;данным.<br /><br /><a name="p-2885-18"></a>
Второй опциональный аргумент result_type в&nbsp;функции Mysql_fetch_array() является константой и&nbsp;может принимать следующие значения: MYSQL_ASSOC, MYSQL_NUM и&nbsp;MYSQL_BOTH. Эта&nbsp;возможность добавлена в&nbsp;PHP 3.0.7.<br /><br /><a name="p-2885-19"></a>
Значением по&nbsp;умолчанию является: MYSQL_BOTH.<br /><br /><a name="p-2885-20"></a>
Используя MYSQL_BOTH, получим массив, состоящий как&nbsp;из&nbsp;ассоциативных индексов, так&nbsp;и&nbsp;из численных. MYSQL_ASSOC вернет только ассоциативные соответствия, а&nbsp;MYSQL_NUM &ndash; только численные.<br /><br /><a name="p-2885-21"></a>
Замечание: имена полей, возвращаемые этой функцией, регистрозависимы.<br /><br /><a name="p-2885-22"></a>
Теперь отобразим данные из&nbsp;Artifacts в&nbsp;виде таблицы в&nbsp;браузере:<br /><br /><a name="p-2885-23"></a>
<!--notypo--><div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?<br /></font><font color="#007700">/&nbsp;*&nbsp;</font><font color="#0000BB">сначала&nbsp;делаем&nbsp;то&nbsp;же</font><font color="#007700">,&nbsp;</font><font color="#0000BB">что&nbsp;и&nbsp;раньше</font><font color="#007700">:&nbsp;</font><font color="#0000BB">устанавливаем<br />соединение</font><font color="#007700">,&nbsp;</font><font color="#0000BB">выбираем&nbsp;базу&nbsp;и&nbsp;получаем&nbsp;список&nbsp;и&nbsp;число&nbsp;полей&nbsp;в&nbsp;таблице&nbsp;Artifacts<br /></font><font color="#007700">*/<br /></font><font color="#0000BB">$conn</font><font color="#007700">=</font><font color="#0000BB">Mysql_connect</font><font color="#007700">(</font><font color="#DD0000">"localhost"</font><font color="#007700">,</font><font color="#DD0000">"nina"</font><font color="#007700">,</font><font color="#DD0000">"123"</font><font color="#007700">);<br /></font><font color="#0000BB">$database&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#DD0000">"book"</font><font color="#007700">;<br /></font><font color="#0000BB">$table_name&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#DD0000">"Artifacts"</font><font color="#007700">;<br /></font><font color="#0000BB">Mysql_select_db</font><font color="#007700">(</font><font color="#0000BB">$database</font><font color="#007700">);<br /></font><font color="#0000BB">$list_f&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">Mysql_list_fields</font><font color="#007700">(</font><font color="#0000BB">$database</font><font color="#007700">,</font><font color="#0000BB">$table_name</font><font color="#007700">);<br /></font><font color="#0000BB">$n1&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">Mysql_num_fields</font><font color="#007700">(</font><font color="#0000BB">$list_f</font><font color="#007700">);<br /></font><font color="#FF8000">//&nbsp;сохраним&nbsp;имена&nbsp;полей&nbsp;в&nbsp;массиве&nbsp;$names<br /></font><font color="#007700">for(</font><font color="#0000BB">$j</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">;</font><font color="#0000BB">$j</font><font color="#007700">&lt;</font><font color="#0000BB">$n1</font><font color="#007700">;&nbsp;</font><font color="#0000BB">$j</font><font color="#007700">++){<br /></font><font color="#0000BB">$names</font><font color="#007700">[]&nbsp;=&nbsp;</font><font color="#0000BB">Mysql_field_name&nbsp;</font><font color="#007700">(</font><font color="#0000BB">$list_f</font><font color="#007700">,</font><font color="#0000BB">$j</font><font color="#007700">);<br />}<br /></font><font color="#0000BB">$sql&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;$table_name"</font><font color="#007700">;&nbsp;</font><font color="#FF8000">//&nbsp;создаем&nbsp;SQL&nbsp;запрос<br /></font><font color="#0000BB">$q&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">Mysql_query</font><font color="#007700">(</font><font color="#0000BB">$sql</font><font color="#007700">,</font><font color="#0000BB">$conn</font><font color="#007700">)&nbsp;or&nbsp;die();&nbsp;</font><font color="#FF8000">//&nbsp;отправляем<br />//&nbsp;запрос&nbsp;на&nbsp;сервер<br /></font><font color="#0000BB">$n&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">Mysql_num_rows</font><font color="#007700">(</font><font color="#0000BB">$q</font><font color="#007700">);&nbsp;</font><font color="#FF8000">//&nbsp;получаем&nbsp;число&nbsp;строк&nbsp;результата<br />//рисуем&nbsp;HTML-таблицу<br /></font><font color="#007700">echo&nbsp;</font><font color="#DD0000">"&amp;nbsp;&lt;TABLE&nbsp;BORDER=0&nbsp;CELLSPACING=0&nbsp;width=90%<br />align=center&gt;&lt;tr&gt;&lt;TD&nbsp;BGCOLOR='#005533'&nbsp;align=center&gt;<br />&lt;font&nbsp;color='#FFFFFF'&gt;&lt;b&gt;$table_name&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;<br />&lt;/tr&gt;&lt;/TABLE&gt;"</font><font color="#007700">;<br />echo&nbsp;</font><font color="#DD0000">"&lt;table&nbsp;cellspacing=0&nbsp;cellpadding=1&nbsp;border=1<br />width=90%&nbsp;align=center&gt;"</font><font color="#007700">;<br /></font><font color="#FF8000">//&nbsp;отображаем&nbsp;названия&nbsp;полей<br /></font><font color="#007700">echo&nbsp;</font><font color="#DD0000">"&lt;tr&gt;"</font><font color="#007700">;<br />foreach&nbsp;(</font><font color="#0000BB">$names&nbsp;</font><font color="#007700">as&nbsp;</font><font color="#0000BB">$val</font><font color="#007700">){<br />echo&nbsp;</font><font color="#DD0000">"&lt;th&nbsp;ALIGN=CENTER&nbsp;BGCOLOR='#C2E3B6'&gt;<br />&lt;font&nbsp;size=2&gt;$val&lt;/font&gt;&lt;/th&gt;"</font><font color="#007700">;<br />}<br /></font><font color="#FF8000">//&nbsp;отображаем&nbsp;значения&nbsp;полей<br /></font><font color="#007700">echo&nbsp;</font><font color="#DD0000">"&lt;/tr&gt;"</font><font color="#007700">;<br />for(</font><font color="#0000BB">$i</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">;</font><font color="#0000BB">$i</font><font color="#007700">&lt;</font><font color="#0000BB">$n</font><font color="#007700">;&nbsp;</font><font color="#0000BB">$i</font><font color="#007700">++){&nbsp;</font><font color="#FF8000">//&nbsp;перебираем&nbsp;все&nbsp;строки&nbsp;в<br />//&nbsp;результате&nbsp;запроса&nbsp;на&nbsp;выборку<br /></font><font color="#007700">echo&nbsp;</font><font color="#DD0000">"&lt;tr&gt;"</font><font color="#007700">;<br />foreach&nbsp;(</font><font color="#0000BB">$names&nbsp;</font><font color="#007700">as&nbsp;</font><font color="#0000BB">$k&nbsp;</font><font color="#007700">=&gt;&nbsp;</font><font color="#0000BB">$val</font><font color="#007700">)&nbsp;{&nbsp;</font><font color="#FF8000">//&nbsp;перебираем&nbsp;все<br />//&nbsp;имена&nbsp;полей<br /></font><font color="#0000BB">$value&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">Mysql_result</font><font color="#007700">(</font><font color="#0000BB">$q</font><font color="#007700">,</font><font color="#0000BB">$i</font><font color="#007700">,</font><font color="#0000BB">$val</font><font color="#007700">);&nbsp;</font><font color="#FF8000">//&nbsp;получаем<br />//&nbsp;значение&nbsp;поля<br /></font><font color="#007700">echo&nbsp;</font><font color="#DD0000">"&lt;td&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;$value&lt;/font&gt;&lt;/td&gt;"</font><font color="#007700">;<br /></font><font color="#FF8000">//&nbsp;выводим&nbsp;значение&nbsp;поля<br /></font><font color="#007700">}<br />echo&nbsp;</font><font color="#DD0000">"&lt;/tr&gt;"</font><font color="#007700">;<br />}<br />echo&nbsp;</font><font color="#DD0000">"&lt;/table&gt;"</font><font color="#007700">;</font>
</font>
</code></div><!--/notypo--><br /><br /><a name="p-2885-24"></a>
<strong>Листинг 11.1.1. Отображение данных из&nbsp;Artifacts в&nbsp;виде таблицы в&nbsp;браузере</strong><br /><br /><a name="p-2885-25"></a>
Сделаем то&nbsp;же самое с&nbsp;помощью Mysql_fetch_array():<br /><br /><a name="p-2885-26"></a>
<!--notypo--><div class="code"><code><font color="#000000">
<font color="#0000BB">&lt;?<br /></font><font color="#FF8000">/*&nbsp;...&nbsp;начало&nbsp;то&nbsp;же,&nbsp;что&nbsp;и&nbsp;в&nbsp;предыдущем&nbsp;примере&nbsp;*/<br />//&nbsp;отображаем&nbsp;значения&nbsp;полей<br /></font><font color="#007700">for(</font><font color="#0000BB">$i</font><font color="#007700">=</font><font color="#0000BB">0</font><font color="#007700">;</font><font color="#0000BB">$i</font><font color="#007700">&lt;</font><font color="#0000BB">$n</font><font color="#007700">;&nbsp;</font><font color="#0000BB">$i</font><font color="#007700">++){<br /></font><font color="#FF8000">//&nbsp;получаем&nbsp;значение&nbsp;поля&nbsp;в&nbsp;виде&nbsp;ассоциативного&nbsp;массива<br /></font><font color="#007700">while(</font><font color="#0000BB">$row&nbsp;</font><font color="#007700">=&nbsp;</font><font color="#0000BB">Mysql_fetch_array</font><font color="#007700">(</font><font color="#0000BB">$q</font><font color="#007700">,&nbsp;</font><font color="#0000BB">MYSQL_ASSOC</font><font color="#007700">))&nbsp;{<br />echo&nbsp;</font><font color="#DD0000">"&lt;tr&gt;"</font><font color="#007700">;<br />foreach&nbsp;(</font><font color="#0000BB">$names&nbsp;</font><font color="#007700">as&nbsp;</font><font color="#0000BB">$k&nbsp;</font><font color="#007700">=&gt;&nbsp;</font><font color="#0000BB">$val</font><font color="#007700">){<br />echo&nbsp;</font><font color="#DD0000">"&lt;td&gt;&lt;font&nbsp;size=2&gt;&amp;nbsp;$row[$val]&lt;/font&gt;&lt;/td&gt;"</font><font color="#007700">;<br /></font><font color="#FF8000">//&nbsp;выводим&nbsp;значение&nbsp;поля<br /></font><font color="#007700">}<br />echo&nbsp;</font><font color="#DD0000">"&lt;/tr&gt;"</font><font color="#007700">;<br />}<br />}<br />echo&nbsp;</font><font color="#DD0000">"&lt;/table&gt;"</font><font color="#007700">;<br /></font><font color="#0000BB">?&gt;</font>
</font>
</code>

           <h2>13. Доступ к Mysql</h2>

<fieldset><legend><strong> Оглавление документа   </strong></legend><div class="toc1"><a href="#h181-2">1. Добавление записей</a></div><div class="toc1"><a href="#h181-3">2. Выбор записей</a></div><div class="toc1"><a href="#h181-4">3. Удаление записей</a></div></fieldset><!--/notypo--><br /><br /><a name="p35477-2"></a>
База данных <!--notypo-->Mysql®<!--/notypo--> стала самой популярной в&nbsp;мире базой данных с&nbsp;открытым исходным кодом — благодаря ее&nbsp;высокой производительности, надежности и&nbsp;легкости использования. Существует более 6 миллионов установок этой базы данных, начиная от&nbsp;больших корпораций и&nbsp;до специализированных встроенных приложений.<br /><br /><a name="p35477-3"></a>
<img src="http://www.webmasterwiki.ru/files//lect5_4_hours_mysql011.gif" /><br /><br /><a name="p35477-4"></a>
Система PHP&nbsp;предоставляет поддержку для&nbsp;Mysql с&nbsp;помощью набора функций, которые можно использовать для&nbsp;манипуляции данными Mysql. Задача этого учебника состоит в&nbsp;том, чтобы познакомить с&nbsp;этими функциями, используемыми обычно в&nbsp;ориентированных на&nbsp;данные приложениях PHP&nbsp;для извлечения, обновления, добавления и&nbsp;удаления данных. Используемые обычно функции PHP&nbsp;для Mysql описаны ниже.<br /><br /><a name="p35477-5"></a>
<!--notypo--><div class="code"><code>Mysql_connect(имя&nbsp;сервера&nbsp;Mysql,имя&nbsp;пользователя,пароль)&nbsp;–&nbsp;открывает&nbsp;соединение&nbsp;с&nbsp;сервером&nbsp;Mysql.<br />
Mysql_select_db(имя&nbsp;базы&nbsp;данных,идентификатор_соединения)&nbsp;–&nbsp;выбирает&nbsp;базу&nbsp;данных,&nbsp;расположенную&nbsp;на&nbsp;сервере&nbsp;Mysql.&nbsp;Параметр&nbsp;<font color="#006666">"имя&nbsp;базы&nbsp;данных"</font>&nbsp;относится&nbsp;к&nbsp;активной&nbsp;базе&nbsp;данных&nbsp;на&nbsp;сервере&nbsp;Mysql,&nbsp;которая&nbsp;была&nbsp;открыта&nbsp;с&nbsp;помощью&nbsp;функции&nbsp;Mysql_connect.<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p35477-6"></a>
&laquo;Идентификатор_соединения&raquo; является ссылкой на&nbsp;текущее соединение с&nbsp;Mysql.<br /><br /><a name="p35477-7"></a>
<!--notypo--><div class="code"><code>Mysql_query(запрос&nbsp;<font color=blue>sql</font>)&nbsp;–&nbsp;посылает&nbsp;запрос&nbsp;активной&nbsp;в&nbsp;данный&nbsp;момент&nbsp;базе&nbsp;данных.<br />
Mysql_fetch_array(resourse&nbsp;result)&nbsp;–&nbsp;возвращает&nbsp;массив,&nbsp;который&nbsp;соответствует&nbsp;извлеченной&nbsp;строке,&nbsp;и&nbsp;перемещает&nbsp;внутренний&nbsp;указатель&nbsp;данных&nbsp;вперед.<br />
Mysql_affected_rows(resourse&nbsp;result)&nbsp;–&nbsp;определяет&nbsp;число&nbsp;строк,&nbsp;затронутых&nbsp;предыдущей&nbsp;операцией&nbsp;<font color=blue>SQL</font>.<br />
Mysql_close(link_identifier)&nbsp;–&nbsp;закрывает&nbsp;соединение&nbsp;Mysql.<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p35477-8"></a>
Прежде чем&nbsp;можно будет применять эти&nbsp;функции для&nbsp;создания приложений обработки данных с&nbsp;помощью Mysql, необходимо получить подходящий доступ к&nbsp;серверу Mysql. Для&nbsp;этого требуется учетная запись пользователя и&nbsp;пароль с&nbsp;полномочиями доступа к&nbsp;базе данных и&nbsp;таблицам, содержащим данные, а&nbsp;также имя&nbsp;хоста сервера Mysql или&nbsp;IP-адрес.<br /><br /><a name="p35477-9"></a>
При&nbsp;работе с&nbsp;сервером Mysql полезно также использовать инструменты управления с&nbsp;графическим интерфейсом, которые обеспечивают более легкий интерфейс использования данных. Популярными инструментами являются:<br /><br /><a name="p35477-10"></a>
SQLyog (доступный на&nbsp;<a href="http://www.webyog.com" target="_blank" title="Внешняя ссылка (откроется в новом окне)" class="outerlink"><img src="http://www.webmasterwiki.ru/themes/canary/icons/web.gif" alt="" border="0" />http://www.webyog.com</a>) и&nbsp;Mysql Administrator (доступный на&nbsp;<a href="http://www.Mysql.com/products/tools/)" target="_blank" title="Внешняя ссылка (откроется в новом окне)" class="outerlink"><img src="http://www.webmasterwiki.ru/themes/canary/icons/web.gif" alt="" border="0" />http://www.Mysql.com/products/tools/)</a>.<br /><a name="h181-2"></a><h2>1. Добавление записей</h2>
<br /><a name="p35477-11"></a>
С&nbsp;помощью рассмотренных в&nbsp;предыдущем разделе функций Mysql и&nbsp;языка SQL&nbsp;можно добавлять записи в&nbsp;таблицу базы данных. Записи добавляются с&nbsp;помощью формы, предоставляющей области для&nbsp;ввода информации. Нажатие кнопки вызывает затем сценарий PHP&nbsp;для записи новой информации в&nbsp;таблицу с&nbsp;помощью команды SQL&nbsp;INSERT.<br /><br /><a name="p35477-12"></a>
<img src="http://www.webmasterwiki.ru/files//lect5_4_hours_mysql021.gif" /><br /><br /><a name="p35477-13"></a>
Поля формы именованы соответствующим образом:<br /><br /><a name="p35477-14"></a>
<!--notypo-->Name — 'Name', Email — 'Email', Web Connection — 'Connection', Residence (City/ST/Country) — 'Residence', Age — 'Age', Gender — 'Gender',<br />Comments — 'Comments'.<!--/notypo--><br /><br /><a name="p35477-15"></a>
Прежде чем&nbsp;подробно рассматривать код, будет полезно посмотреть на&nbsp;синтаксис оператора SQL&nbsp;INSERT:<br /><br /><a name="p35477-16"></a>
<!--notypo--><div class="code"><code><font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;TableName&nbsp;(FieldName1&nbsp;[,FieldName2]...)&nbsp;<font color=blue>VALUES</font>&nbsp;(Value1&nbsp;[,Value2]...)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p35477-17"></a>
Более подробное рассмотрение оператора INSERT дано в&nbsp;приложении.<br /><br /><a name="p35477-18"></a>
Следующий код&nbsp;используется для&nbsp;обработки данных формы <!--notypo-->VisitorSurvey.php<!--/notypo-->:<br />
<strong><!--notypo-->VisitorSurvey.php<!--/notypo--></strong><br /><br /><a name="p35477-19"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">submit</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"Submit"</span><span style="color: #007700">)<br />{<br /></span><span style="color: #FF8000">//Получение&nbsp;данных&nbsp;формы&nbsp;и&nbsp;присвоение&nbsp;скалярным&nbsp;переменным<br /></span><span style="color: #0000BB">$Name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Name</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Email</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Connection</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Residence&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Residence</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Age&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Age</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Gender&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Gender</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Comments&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Comments</span><span style="color: #007700">];<br /></span><span style="color: #FF8000">//Установление&nbsp;соединения&nbsp;с&nbsp;базой&nbsp;данных<br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,</span><span style="color: #DD0000">'root'</span><span style="color: #007700">,</span><span style="color: #DD0000">'xyxyxy'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//Выбор&nbsp;базы&nbsp;данных&nbsp;Mysql<br /></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">'Membership'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//Оператор&nbsp;SQL<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;Survey&nbsp;"&nbsp;</span><span style="color: #007700">.<br /></span><span style="color: #DD0000">"(Name,Email,Connection,Residence,Age,Gender,Comments)&nbsp;VALUES&nbsp;('$Name',<br />'$Email',&nbsp;'$Connection',<br />'$Residence',&nbsp;'$Age',&nbsp;'$Gender',&nbsp;'$Comments')"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//Выполнение&nbsp;оператора&nbsp;SQL&nbsp;и&nbsp;сохранение&nbsp;результатов&nbsp;в&nbsp;множестве&nbsp;записей<br /></span><span style="color: #0000BB">$rs&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">,</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">Mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p35477-20"></a>
<strong>Пример 10.1.</strong><br /><br /><a name="p35477-21"></a>
После нажатия кнопки отправки Submit создается суперглобальный массив $_POST, содержащий значения из&nbsp;формы. Значения массива присваиваются скалярным переменным. Это&nbsp;упрощает кодирование оператора SQL. Затем выполняется оператор Mysql_connect(). Этот оператор требует три&nbsp;параметра – имя&nbsp;хоста сервера Mysql, имя&nbsp;пользователя, и&nbsp;пароль. Здесь для&nbsp;соединения с&nbsp;базой данных Mysql используется строка соединения без&nbsp;DSN. Ссылка на&nbsp;соединение хранится в&nbsp;переменной $conn. Это&nbsp;пример ссылочной переменной PHP. В&nbsp;отличие от&nbsp;скалярных переменных и&nbsp;массивов, ссылочные переменные не&nbsp;применяются непосредственно в&nbsp;программе, но&nbsp;часто используются как&nbsp;параметры для&nbsp;других функций. После соединения с&nbsp;сервером базы данных Mysql следующий шаг&nbsp;состоит в&nbsp;выборе базы данных. Так&nbsp;как экземпляр сервера Mysql может содержать большое число баз&nbsp;данных, то&nbsp;задействуется функция Mysql_select_db для&nbsp;выбора одной из&nbsp;них для&nbsp;использования в&nbsp;приложении. Эта&nbsp;функция требует два&nbsp;параметра – имя&nbsp;базы данных и&nbsp;ссылку на&nbsp;соединение Mysql. Вслед за&nbsp;выбором базы данных формируется оператор SQL&nbsp;INSERT и&nbsp;присваивается переменной $sql. Затем функция Mysql_query() выполняет оператор SQL, создающий множество записей (множество записей базы данных).<br /><br /><a name="p35477-22"></a>
Это&nbsp;множество записей присваивается переменной $rs, еще&nbsp;одной ссылочной переменной PHP. Отметим, что&nbsp;функция Mysql_query() требует два&nbsp;параметра — $sql (ссылка на&nbsp;текущий оператор SQL) и $conn (ссылка на&nbsp;текущее соединение с&nbsp;базой данных). Наконец, вызывается функция close() для&nbsp;закрытия текущего соединения с&nbsp;базой данных. Для&nbsp;таких приложений обычно желательно выполнять проверку данных, прежде чем&nbsp;заносить данные в&nbsp;таблицу базы данных. Это&nbsp;необходимо делать перед установлением соединения с&nbsp;базой данных с&nbsp;помощью методов, рассмотренных в&nbsp;разделе <span class="nobr">6&ndash;2</span>.<br /><br /><a name="p35477-23"></a>
В&nbsp;случае ошибки кодирования данные не&nbsp;заносятся в&nbsp;таблицу базы данных, а&nbsp;PHP выведет предупреждение или&nbsp;сообщение об&nbsp;ошибке. В&nbsp;такой ситуации полезно подавить эти&nbsp;критические сообщения, добавить код&nbsp;для проверки ошибок вручную и&nbsp;сгенерировать более понятный для&nbsp;пользователя вывод. Это&nbsp;можно делать сразу после оператора Mysql_query(), проверяя статус вновь созданного множества записей — $rs.<br /><br /><a name="p35477-24"></a>
Предположим, что&nbsp;в&nbsp;предыдущем коде функция Mysql_query() содержит вместо $sql параметр $sqlString. В&nbsp;этом случае PHP&nbsp;немедленно прекратит выполнение страницы и&nbsp;выведет сообщение об&nbsp;ошибке.<br /><br /><a name="p35477-25"></a>
Вывод сообщения об&nbsp;ошибке PHP&nbsp;можно подавить с&nbsp;помощью оператора управления ошибками "@". При&nbsp;подавленном сообщении об&nbsp;ошибке можно добавить код&nbsp;для создания более понятного пользователю сообщения. Такой подход показан ниже:<br /><br /><a name="p35477-26"></a>
<strong><!--notypo-->VisitorSurvey.php<!--/notypo--></strong><br /><br /><a name="p35477-27"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">submit</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"Submit"</span><span style="color: #007700">)<br />{<br /></span><span style="color: #FF8000">//Получение&nbsp;данных&nbsp;формы&nbsp;и&nbsp;присвоение&nbsp;скалярным&nbsp;переменным<br /></span><span style="color: #0000BB">$Name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Name</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Email&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Email</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Connection&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Connection</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Residence&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Residence</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Age&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Age</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Gender&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Gender</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$Comments&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">Comments</span><span style="color: #007700">];<br /></span><span style="color: #FF8000">//Установление&nbsp;соединения&nbsp;с&nbsp;базой&nbsp;данных<br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,</span><span style="color: #DD0000">'root'</span><span style="color: #007700">,</span><span style="color: #DD0000">'xyxyxy'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//Выбор&nbsp;базы&nbsp;данных&nbsp;Mysql<br /></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">'Membership'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//Оператор&nbsp;SQL<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"INSERT&nbsp;INTO&nbsp;Survey&nbsp;"&nbsp;</span><span style="color: #007700">.<br /></span><span style="color: #DD0000">"(Name,Email,Connection,Residence,Age,Gender,Comments)&nbsp;VALUES&nbsp;('$Name',<br />'$Email',&nbsp;'$Connection',<br />'$Residence',&nbsp;'$Age',&nbsp;'$Gender',&nbsp;'$Comments')"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">//Выполнение&nbsp;оператора&nbsp;SQL&nbsp;и&nbsp;сохранение&nbsp;результатов&nbsp;в&nbsp;виде&nbsp;множества&nbsp;записей<br /></span><span style="color: #0000BB">$rs&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">Mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sqlstring</span><span style="color: #007700">,</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />if&nbsp;(!</span><span style="color: #0000BB">$rs</span><span style="color: #007700">)<br />{<br />echo&nbsp;</span><span style="color: #DD0000">"Произошла&nbsp;ошибка.&nbsp;Попробуйте&nbsp;еще&nbsp;раз."</span><span style="color: #007700">;<br />}<br />else<br />{<br />echo&nbsp;</span><span style="color: #DD0000">"Запись&nbsp;была&nbsp;успешно&nbsp;добавлена."</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">Mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p35477-28"></a>
<strong>Пример 10.2.</strong><br /><br /><a name="p35477-29"></a>
Вслед за&nbsp;функцией Mysql_query() используется оператор if&nbsp;для проверки статуса множества записей $rs. Если множество записей успешно создается, выводится сообщение &laquo;Запись была успешно добавлена&raquo;. Если возникает проблема, выводится сообщение &laquo;Произошла ошибка. Попробуйте еще&nbsp;раз.&raquo;<br /><a name="h181-3"></a><h2>2. Выбор записей</h2>
<br /><a name="p35477-30"></a>
Кроме применения функций Mysql с&nbsp;оператором SQL&nbsp;INSERT для&nbsp;добавления записей в&nbsp;базу данных, можно также извлекать записи из&nbsp;таблицы базы данных с&nbsp;помощью оператора SQL&nbsp;SELECT.<br /><br /><a name="p35477-31"></a>
Типичная форма ввода для&nbsp;выбора существующих записей из&nbsp;таблицы Directory показана ниже. В&nbsp;этом примере фиктивная компания, Company XYZ, имеет онлайн форму, которая позволяет пользователям ввести фамилию сотрудника и&nbsp;найти полное имя&nbsp;сотрудника, номер телефона и&nbsp;адрес e-mail.<br /><br /><a name="p35477-32"></a>
<img src="http://www.webmasterwiki.ru/files//lect5_4_hours_mysql031.gif" /><br /><br /><a name="p35477-33"></a>
Оператор SQL&nbsp;SELECT показан ниже:<br /><br /><a name="p35477-34"></a>
<!--notypo-->SELECT * | [DISTINCT] field1 [,field2]... FROM TableName WHERE criteria ORDER BY FieldName1 [ASC|DESC] [,FieldName2 [ASC|DESC] ]...<!--/notypo--><br /><br /><a name="p35477-35"></a>
Более подробно оператор SELECT рассматривается в&nbsp;приложении.<br /><br /><a name="p35477-36"></a>
Следующий код&nbsp;используется для&nbsp;обработки формы <!--notypo-->DirectorySearch.php<!--/notypo-->:<br /><br /><a name="p35477-37"></a>
<strong><!--notypo-->DirectorySearch.php<!--/notypo--></strong><br /><br /><a name="p35477-38"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">submit</span><span style="color: #007700">]&nbsp;==&nbsp;</span><span style="color: #DD0000">"Search"</span><span style="color: #007700">)<br />{<br /></span><span style="color: #FF8000">//Получение&nbsp;данных&nbsp;формы<br /></span><span style="color: #0000BB">$string&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'search'</span><span style="color: #007700">];<br /></span><span style="color: #FF8000">//Установление&nbsp;соединения&nbsp;с&nbsp;данными<br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,</span><span style="color: #DD0000">'root'</span><span style="color: #007700">,</span><span style="color: #DD0000">'xyxyxy'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//Выбор&nbsp;базы&nbsp;данных<br /></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">'Membership'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//Создание&nbsp;оператора&nbsp;SQL&nbsp;SELECT<br /></span><span style="color: #0000BB">$sql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;Directory&nbsp;WHERE&nbsp;LName&nbsp;=&nbsp;'$string'"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$rs&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sql</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p35477-39"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;"-//W3C/DTD/XHTML&nbsp;1.0&nbsp;Transitional//EN"<br />"http://www.w3.org/TR/xhtml1/DTD/xhtml11-transitional.dtd"&gt;<br />&lt;html&nbsp;xmlns="http://www.w3.org/1999/xhtml"&nbsp;xml:lang="en"&nbsp;lang="en"&gt;<br />&lt;head&gt;<br />&lt;title&gt;Страница&nbsp;Web&nbsp;&lt;/title&gt;<br />&lt;style&gt;<br />body&nbsp;{margin:15px;font:10pt&nbsp;Verdana}<br />td&nbsp;{vertical-align:top;border:solid&nbsp;1px&nbsp;gray}<br />input,textarea{border:0px}<br />&lt;/style&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;form&nbsp;action="DirectorySearch.php"&nbsp;method="post"&gt;<br />&lt;p&gt;Введите&nbsp;ниже&nbsp;фамилию&nbsp;и&nbsp;нажмите&nbsp;кнопку&nbsp;"Search",<br />чтобы&nbsp;найти&nbsp;номер&nbsp;телефона&nbsp;и&nbsp;адрес&nbsp;e-mail&nbsp;сотрудника&lt;/p&gt;<br />&lt;table&gt;<br />&lt;tr&gt;<br />&lt;td&nbsp;colspan="2"&gt;Company&nbsp;XYZ&nbsp;Directory&lt;/td&gt;<br />&lt;/tr&gt;<br />&lt;td&gt;&lt;input&nbsp;type="text"&nbsp;size="15"&nbsp;name="SearchName"/&gt;&lt;/td&gt;<br />&lt;td&gt;&lt;input&nbsp;type="submit"&nbsp;value="Search"&nbsp;name="submit"/&gt;<br />&lt;/tr&gt;<br />&lt;/table&gt;<br />&lt;/form&gt;<br />&lt;div&gt;<br /><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if(!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">))<br />{<br />while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$rs</span><span style="color: #007700">))<br />{<br />echo&nbsp;</span><span style="color: #DD0000">"Name:&nbsp;"&nbsp;</span><span style="color: #007700">.</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'FName'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'LName'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Telephone:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Telephone'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Email:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Email'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">Mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</span>
</code></div><!--/notypo--><br /><br /><a name="p35477-40"></a>
<strong>Пример 10.3.</strong><br /><br /><a name="p35477-41"></a>
Эта&nbsp;страница содержит два&nbsp;блока кода PHP. Первый выполняется, когда нажимается кнопка отправки формы &#147;Search&#148;. Введенная пользователем фамилия присваивается скалярной переменной '$string'. Затем создается соединение с&nbsp;базой данных и&nbsp;формируется оператор SQL&nbsp;SELECT для&nbsp;выбора всех (*) полей таблицы записей, в&nbsp;которых поле 'lastname' совпадает со&nbsp;строкой фамилии, введенной пользователем. В&nbsp;конце выполняется оператор SQL. Если найдены подходящие записи, то&nbsp;множество записей присваивается переменной '$rs'.<br /><br /><a name="p35477-42"></a>
Второй блок кода появляется в&nbsp;теле документа XHTML. Код, содержащий операторы echo или&nbsp;print, помещается обычно между открывающим и&nbsp;закрывающим тегами &lt;body&gt;, так&nbsp;что он&nbsp;может выводиться или&nbsp;форматироваться в&nbsp;соответствии с&nbsp;другими элементами страницы. Операторы echo и&nbsp;print, появляющиеся в&nbsp;блоках PHP, закодированные выше тега &lt;html&gt;, всегда появляются в&nbsp;верху страницы и&nbsp;предшествуют всем другим ее&nbsp;элементам.<br /><br /><a name="p35477-43"></a>
Назначение этого блока кода состоит в&nbsp;выводе извлеченных записей, если в&nbsp;предыдущем блоке кода был&nbsp;выполнен оператор SQL. <br /><br /><a name="p35477-44"></a>
Сначала используется оператор if&nbsp;для проверки, что&nbsp;массив $POST не&nbsp;является пустым. Если этот массив будет пустым, то&nbsp;это означает, что&nbsp;форма не&nbsp;была отправлена, и&nbsp;никакие записи не&nbsp;были извлечены. Если этот условный оператор отсутствует, то&nbsp;будет возникать ошибка, так&nbsp;как массив Mysql_fetch_array не&nbsp;будет содержать никаких значений.<br /><br /><a name="p35477-45"></a>
Затем используется цикл while для&nbsp;итераций по&nbsp;множеству записей. Во&nbsp;время каждой итерации по&nbsp;множеству записей функция Mysql_fetch_array() создает ассоциативный массив (здесь этот массив назван $row), содержащий значения полей текущей записи. Индексы массива соответствуют именам полей формы, а&nbsp;элемент массива соответствует значению поля. Каждая запись затем выводит<br />
<!--notypo-->$row['FName'] — значение поля 'FirstName', $row['LName'] -- значение поля 'LastName', $row['Telephone'] – значение поля 'Telephone', и $row['Email'] – значение поля 'Email'<!--/notypo-->. Этот процесс продолжается, пока не&nbsp;будет достигнут конец множества записей, при&nbsp;этом массив $row каждый раз&nbsp;будет содержать новые значения.<br /><br /><a name="p35477-46"></a>
После вывода всех записей соединение с&nbsp;базой данных закрывается с&nbsp;помощью функции Mysql_close().<br /><br /><a name="p35477-47"></a>
Ниже представлен пример вывода, созданного после поиска в&nbsp;каталоге.<br /><br /><a name="p35477-48"></a>
<img src="http://www.webmasterwiki.ru/files//lect5_4_hours_mysql041.gif" /><br /><br /><a name="p35477-49"></a>
Если пользователь ищет фамилию, которая не&nbsp;существует в&nbsp;таблице базы данных, то&nbsp;никакие записи не&nbsp;выводятся. Чтобы предотвратить путаницу, приведенный выше сценарий можно немного изменить так, что&nbsp;будет выводиться соответствующее сообщение, если подходящие записи не&nbsp;будут найдены.<br /><br /><a name="p35477-50"></a>
<strong><!--notypo-->DirectorySearch.php<!--/notypo--></strong><br /><br /><a name="p35477-51"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if(!empty(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">))<br />{<br />while(</span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$rs</span><span style="color: #007700">))<br />{<br />echo&nbsp;</span><span style="color: #DD0000">"Name:&nbsp;"&nbsp;</span><span style="color: #007700">.</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'FName'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'LName'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Telephone:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Telephone'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"Email:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">'Email'</span><span style="color: #007700">]&nbsp;.&nbsp;</span><span style="color: #DD0000">"&lt;br/&gt;"</span><span style="color: #007700">;<br />}<br />if&nbsp;(</span><span style="color: #0000BB">Mysql_affected_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$rs</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">)<br />{<br />echo&nbsp;</span><span style="color: #DD0000">"No&nbsp;records&nbsp;found!"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">Mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</span>
</code></div><!--/notypo--><br /><a name="h181-4"></a><h2>3. Удаление записей</h2>
<br /><a name="p35477-52"></a>
Оператор SQL&nbsp;DELETE используется для&nbsp;удаления существующих записей в&nbsp;базе данных.<br /><br /><a name="p35477-53"></a>
Синтаксис оператора SQL&nbsp;DELETE показан ниже:<br /><br /><a name="p35477-54"></a>
DELETE FROM Имя_Таблицы WHERE критерий<br /><br /><a name="p35477-55"></a>
Более подробно оператор DELETE рассматривается в&nbsp;приложении.<br /><br /><a name="p35477-56"></a>
Следующая форма представляет запись пользователя, которая будет удалена из&nbsp;таблицы базы данных Personnel. Щелчок на&nbsp;кнопке Delete вызывает процедуру PHP, которая выполняет оператор SQL&nbsp;DELETE для&nbsp;удаления этой записи из&nbsp;таблицы базы данных.<br /><br /><a name="p35477-57"></a>
Показанный выше измененный сценарий содержит дополнительно функцию Mysql_affected_rows(). Эта&nbsp;функция требует один параметр – ссылку на&nbsp;текущее множество записей $rs и&nbsp;определяет число строк, затронутых последней операцией SQL. Если возвращаемое функцией Mysql_affected_rows() значение равно 0, то&nbsp;оператор SQL&nbsp;SELECT не&nbsp;затронул ни&nbsp;одной строки. Поэтому подходящих записей найдено не&nbsp;было.<br /><br /><a name="p35477-58"></a>
<img src="http://www.webmasterwiki.ru/files//lect5_4_hours_mysql051.gif" /><br /><br /><a name="p35477-59"></a>
скрытое текстовое поле с&nbsp;именем "<span class="missingpage">Auto&nbsp;Num</span><a href="http://www.webmasterwiki.ru/MySQL/AutoNum/edit?add=1" title="Создать эту страницу">?</a>" со&nbsp;значением, равным полю <!--notypo-->AutoNum<!--/notypo--> таблицы базы данных. Это&nbsp;поле используется для&nbsp;уникальной идентификации каждой записи. Следующий код&nbsp;демонстрирует, как&nbsp;работает страница:<br /><br /><a name="p35477-60"></a>
<strong><!--notypo-->DirectorySearch.php<!--/notypo--></strong><br /><br /><a name="p35477-61"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'submitb'</span><span style="color: #007700">]==</span><span style="color: #DD0000">"Delete&nbsp;Record"</span><span style="color: #007700">)<br />{<br /></span><span style="color: #0000BB">$conn&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'localhost'</span><span style="color: #007700">,</span><span style="color: #DD0000">'root'</span><span style="color: #007700">,</span><span style="color: #DD0000">'xyxyxy'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$db&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">'Membership'</span><span style="color: #007700">,</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$sqlDelete&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"DELETE&nbsp;FROM&nbsp;Personnel&nbsp;WHERE&nbsp;AutoNum&nbsp;="&nbsp;</span><span style="color: #007700">.<br /></span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'AutoNum'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$rsDelete&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$sqlDelete</span><span style="color: #007700">,</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />if(</span><span style="color: #0000BB">Mysql_affected_rows</span><span style="color: #007700">(</span><span style="color: #0000BB">$rsDelete</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)<br />{<br />echo&nbsp;</span><span style="color: #DD0000">"Запись&nbsp;успешно&nbsp;удалена!"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">Mysql_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><br /><a name="p35477-62"></a>
После нажатия кнопки &#147;Delete Record&#148; устанавливается соединение с&nbsp;базой данных Mysql. Затем создается оператор SQL&nbsp;DELETE для&nbsp;удаления записи из&nbsp;таблицы Personnel со&nbsp;значением поля <!--notypo-->AutoNum<!--/notypo-->, равным значению скрытого текстового поля <!--notypo-->AutoNum<!--/notypo-->. Затем оператор SQL&nbsp;выполняется. Результаты работы функции Mysql_query() присваиваются переменной $rsDelete. Последний шаг&nbsp;состоит в&nbsp;проверке, что&nbsp;удаление записи прошло успешно, и&nbsp;в выводе подтверждающего сообщения. Функция Mysql_affected_rows() используется для&nbsp;определения числа строк в&nbsp;множестве результатов ODBC или&nbsp;числа строк, затронутых оператором Mysql_query(). Так&nbsp;как будет удалена только одна запись, то&nbsp;результат Mysql_affected_rows() равный 1 означает, что&nbsp;запись удалена успешно. В&nbsp;конце соединение с&nbsp;базой данных закрывается.<br />   <script language="JavaScript" type="text/javascript">
   var dbclick = "page";
  </script>
<br style="clear:both" />&nbsp;
</div>

           <h2>14. Безопасное взаимодействие MySQL и PHP</h2>
           
           <p>Внедрение SQL-кода (англ. <em>SQL injection</em>) — один из&nbsp;распространённых способов взлома сайтов и&nbsp;программ, работающих с&nbsp;базами данных, основанный на&nbsp;внедрении в&nbsp;запрос произвольного SQL-кода.<br /><br /><a name="p-1437-2"></a>
Внедрение SQL, в&nbsp;зависимости от&nbsp;типа используемой СУБД и&nbsp;условий внедрения, может дать возможность атакующему выполнить произвольный запрос к&nbsp;базе данных (<em>например, прочитать содержимое любых таблиц, удалить, изменить или&nbsp;добавить данные</em>), получить возможность чтения и/или записи локальных файлов и&nbsp;выполнения произвольных команд на&nbsp;атакуемом сервере.<br />
Атака типа внедрения SQL&nbsp;может быть возможна из-за некорректной обработки входящих данных, используемых в&nbsp;SQL-запросах.<br />
Разработчик прикладных программ, работающих с&nbsp;базами данных, должен знать о&nbsp;таких уязвимостях и&nbsp;принимать меры противодействия внедрению SQL.<br /><br /><a name="p-1437-3"></a>
<!--notypo--><fieldset><legend><strong> Оглавление документа   </strong></legend><div class="toc1"><a href="#h306-1">1. Принцип атаки внедрения SQL</a></div><div class="toc2"><a href="#h306-2">1.1. Внедрение в&nbsp;строковые параметры</a></div><div class="toc2"><a href="#h306-3">1.2. Использование UNION</a></div><div class="toc2"><a href="#h306-4">1.3. Использование UNION + group_concat()</a></div><div class="toc2"><a href="#h306-5">1.4. Экранирование хвоста запроса</a></div><div class="toc2"><a href="#h306-6">1.5. Расщепление SQL-запроса</a></div><div class="toc1"><a href="#h306-7">2. Методика атак типа внедрение SQL-кода</a></div><div class="toc2"><a href="#h306-8">2.1. Поиск скриптов, уязвимых для&nbsp;атаки</a></div><div class="toc1"><a href="#h306-9">3. Защита от&nbsp;атак типа внедрение SQL-кода</a></div><div class="toc2"><a href="#h306-10">3.1. Фильтрация строковых параметров</a></div><div class="toc2"><a href="#h306-11">3.2. Фильтрация целочисленных параметров</a></div><div class="toc2"><a href="#h306-12">3.3. Усечение входных параметров</a></div><div class="toc2"><a href="#h306-13">3.4. Использование параметризованных запросов</a></div></fieldset><!--/notypo--><br /><a name="h306-1"></a><h2>1. Принцип атаки внедрения SQL</h2>
<br /><a name="p-1437-4"></a>
Допустим, серверное ПО, получив входной параметр id, использует его&nbsp;для создания SQL-запроса. Рассмотрим следующий PHP-скрипт:<br /><br /><a name="p-1437-5"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
#&nbsp;Предыдущий&nbsp;код&nbsp;скрипта...<br />$id&nbsp;=&nbsp;$_REQUEST['id'];<br />$res&nbsp;=&nbsp;mysql_query("SELECT&nbsp;*&nbsp;FROM&nbsp;news&nbsp;WHERE&nbsp;id_news&nbsp;=&nbsp;$id");<br />#&nbsp;Следующий&nbsp;код&nbsp;скрипта...</span>
</code></div><!--/notypo--><br /><br /><a name="p-1437-6"></a>
Если на&nbsp;сервер передан параметр id, равный 5 (например так: <strong><!--notypo-->http://example.org/script.php?id=5<!--/notypo--></strong>), то&nbsp;выполнится следующий SQL-запрос:<br /><br /><a name="p-1437-7"></a>
<!--notypo--><div class="code"><code><font color=blue>SELECT</font>&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id_news&nbsp;=&nbsp;<font color=green><b>5</b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-8"></a>
Но&nbsp;если злоумышленник передаст в&nbsp;качестве параметра id&nbsp;строку <strong>-1 OR&nbsp;1=1</strong> (например, так: <strong><!--notypo-->http://example.org/script.php?id=-1+OR+1=1<!--/notypo--></strong>), то&nbsp;выполнится запрос:<br /><br /><a name="p-1437-9"></a>
<!--notypo--><div class="code"><code><font color=blue>SELECT</font>&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id_news&nbsp;=&nbsp;-1&nbsp;<font color=blue>OR</font>&nbsp;<font color=green><b>1</b></font>=<font color=green><b>1</b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-10"></a>
Таким образом, изменение входных параметров путём добавления в&nbsp;них конструкций языка SQL&nbsp;вызывает изменение в&nbsp;логике выполнения SQL-запроса (в данном примере вместо новости с&nbsp;заданным идентификатором будут выбраны все&nbsp;имеющиеся в&nbsp;базе новости, поскольку выражение 1=1 всегда истинно).<br /><a name="h306-2"></a><h3>1.1. Внедрение в&nbsp;строковые параметры</h3>
<br /><a name="p-1437-11"></a>
Предположим, серверное ПО, получив запрос на&nbsp;поиск данных в&nbsp;новостях параметром search_text, использует его&nbsp;в&nbsp;следующем SQL-запросе (здесь параметры экранируются кавычками):<br /><br /><a name="p-1437-12"></a>
<!--notypo--><div class="code"><code>$search_text&nbsp;=&nbsp;$_REQUEST['search_text'];<br />
<font color="#770055">$res</font>&nbsp;=&nbsp;mysql_query(<font color="#006666">"SELECT&nbsp;id_news,&nbsp;news_date,&nbsp;news_caption,&nbsp;news_text,&nbsp;news_id_author<br />
<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;news_caption&nbsp;<font color=blue>LIKE</font>('%$search_text%')"</font>);<font color=green><b></b></font></code></div><!--/notypo--><br /><div class="indent"><div class="indent"><div class="indent"><div class="indent"><div class="indent"><div class="indent"><div class="indent"><div class="indent"><div class="indent"><div class="indent"><div class="indent"></div></div></div></div></div></div></div></div></div></div></div><a name="p-1437-13"></a>
Сделав запрос вида <strong><!--notypo-->http://example.org/script.php?search_text=Test<!--/notypo--></strong> мы&nbsp;получим выполнение следующего SQL-запроса:<br /><br /><a name="p-1437-14"></a>
<!--notypo--><div class="code"><code><font color=blue>SELECT</font>&nbsp;id_news,&nbsp;news_date,&nbsp;news_caption,&nbsp;news_text,&nbsp;news_id_author&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<br />
<font color=blue>WHERE</font>&nbsp;news_caption&nbsp;<font color=blue>LIKE</font>('%Test%')<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-15"></a>
Но, внедрив в&nbsp;параметр search_text символ кавычки (который используется в&nbsp;запросе), мы&nbsp;можем кардинально изменить поведение SQL-запроса. Например, передав в&nbsp;качестве параметра search_text значение '<strong>)+and+(news_id_author='1</strong>, мы&nbsp;вызовем к&nbsp;выполнению запрос:<br /><br /><a name="p-1437-16"></a>
<!--notypo--><div class="code"><code><font color=blue>SELECT</font>&nbsp;id_news,&nbsp;news_date,&nbsp;news_caption,&nbsp;news_text,&nbsp;news_id_author&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<br />
<font color=blue>WHERE</font>&nbsp;news_caption&nbsp;<font color=blue>LIKE</font>('%')&nbsp;<font color=blue>AND</font>&nbsp;(news_id_author='1%')<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h306-3"></a><h3>1.2. Использование UNION</h3>
<br /><a name="p-1437-17"></a>
Язык SQL&nbsp;позволяет объединять результаты нескольких запросов при&nbsp;помощи оператора UNION. Это&nbsp;предоставляет злоумышленнику возможность получить несанкционированный доступ к&nbsp;данным.<br />
Рассмотрим скрипт отображения новости (<em>идентификатор новости, которую необходимо отобразить, передается в&nbsp;параметре id</em>):<br /><br /><a name="p-1437-18"></a>
<!--notypo--><div class="code"><code><font color="#770055">$res</font>&nbsp;=&nbsp;mysql_query(<font color="#006666">"SELECT&nbsp;id_news,&nbsp;header,&nbsp;<font color=blue>body</font>,&nbsp;author&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id_news&nbsp;=&nbsp;"</font>&nbsp;.&nbsp;$_REQUEST['id']);<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-19"></a>
Если злоумышленник передаст в&nbsp;качестве параметра id&nbsp;конструкцию <strong>-1 UNION SELECT 1,username,password,1 FROM admin</strong>, это&nbsp;вызовет выполнение SQL-запроса<br /><br /><a name="p-1437-20"></a>
<!--notypo--><div class="code"><code><font color=blue>SELECT</font>&nbsp;id_news,&nbsp;header,&nbsp;<font color=blue>body</font>,&nbsp;author&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id_news&nbsp;=&nbsp;-1&nbsp;<font color=blue>UNION</font>&nbsp;<font color=blue>SELECT</font>&nbsp;<font color=green><b>1</b></font>,username,<font color=blue>password</font>,<font color=green><b>1</b></font>&nbsp;<font color=blue>FROM</font>&nbsp;admin</code></div><!--/notypo--><br /><br /><a name="p-1437-21"></a>
Так&nbsp;как новости с&nbsp;идентификатором -1 заведомо не&nbsp;существует, из&nbsp;таблицы news не&nbsp;будет выбрано ни&nbsp;одной записи, однако в&nbsp;результат попадут записи, несанкционированно отобранные из&nbsp;таблицы admin в&nbsp;результате инъекции SQL.<br /><a name="h306-4"></a><h3>1.3. Использование UNION + group_concat()</h3>
<br /><a name="p-1437-22"></a>
В&nbsp;некоторых случаях хакер может провести атаку, но&nbsp;не может видеть более одной колонки. В&nbsp;случае <span class="missingpage">My&nbsp;SQL</span><a href="http://www.webmasterwiki.ru/MySQL/MySQL/edit?add=1" title="Создать эту страницу">?</a> взломщик может воспользоваться функцией:<br /><br /><a name="p-1437-23"></a>
<!--notypo--><div class="code"><code>group_concat(col,&nbsp;symbol,&nbsp;col)<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-24"></a>
которая объединяет несколько колонок в&nbsp;одну. Например, для&nbsp;примера данного выше вызов функции будет таким:<br /><br /><a name="p-1437-25"></a>
<!--notypo--><div class="code"><code>-1&nbsp;<font color=blue>UNION</font>&nbsp;<font color=blue>SELECT</font>&nbsp;group_concat(username,&nbsp;0x3a,&nbsp;<font color=blue>password</font>)&nbsp;<font color=blue>FROM</font>&nbsp;admin</code></div><!--/notypo--><br /><a name="h306-5"></a><h3>1.4. Экранирование хвоста запроса</h3>
<br /><a name="p-1437-26"></a>
Зачастую, SQL-запрос, подверженный данной уязвимости, имеет структуру, усложняющую или&nbsp;препятствующую использованию union. Например скрипт<br /><br /><a name="p-1437-27"></a>
<!--notypo--><div class="code"><code><font color="#770055">$res</font>&nbsp;=&nbsp;mysql_query(<font color="#006666">"SELECT&nbsp;author&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id="</font>&nbsp;.&nbsp;$_REQUEST['id']&nbsp;.<font color="#006666">"&nbsp;<font color=blue>AND</font>&nbsp;author&nbsp;<font color=blue>LIKE</font>&nbsp;('a%')"</font>);<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-28"></a>
отображает имя&nbsp;автора новости по&nbsp;передаваемому идентификатору id&nbsp;только при&nbsp;условии, что&nbsp;имя начинается с&nbsp;буквы а, и&nbsp;внедрение кода с&nbsp;использованием оператора UNION затруднительно.<br />
В&nbsp;таких случаях, злоумышленниками используется метод экранирования части запроса при&nbsp;помощи символов комментария(/* или&nbsp;&mdash; в&nbsp;зависимости от&nbsp;типа СУБД).<br /><br /><a name="p-1437-29"></a>
В&nbsp;данном примере, злоумышленник может передать в&nbsp;скрипт параметр id&nbsp;со значением -<strong>1 UNION SELECT password FROM admin/</strong>*, выполнив таким образом запрос<br /><br /><a name="p-1437-30"></a>
<!--notypo--><div class="code"><code><font color=blue>SELECT</font>&nbsp;author&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id=-1&nbsp;<font color=blue>UNION</font>&nbsp;<font color=blue>SELECT</font>&nbsp;<font color=blue>password</font>&nbsp;<font color=blue>FROM</font>&nbsp;admin/*&nbsp;<font color=blue>AND</font>&nbsp;author&nbsp;<font color=blue>LIKE</font>&nbsp;('a%')<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-31"></a>
в&nbsp;котором часть запроса ( AND&nbsp;author LIKE ('a%')) помечена как&nbsp;комментарий и&nbsp;не влияет на&nbsp;выполнение.<br /><a name="h306-6"></a><h3>1.5. Расщепление SQL-запроса</h3>
<br /><a name="p-1437-32"></a>
Для&nbsp;разделения команд в&nbsp;языке SQL&nbsp;используется символ ; (точка с&nbsp;запятой), внедряя этот символ в&nbsp;запрос, злоумышленник получает возможность выполнить несколько команд в&nbsp;одном запросе, однако не&nbsp;все диалекты SQL&nbsp;поддерживают такую возможность.<br /><br /><a name="p-1437-33"></a>
Например, если в&nbsp;параметры скрипта<br /><br /><a name="p-1437-34"></a>
<!--notypo--><div class="code"><code><font color="#770055">$id</font>&nbsp;=&nbsp;$_REQUEST['id'];<br />
<font color="#770055">$res</font>&nbsp;=&nbsp;mysql_query(<font color="#006666">"SELECT&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id_news&nbsp;=&nbsp;$id"</font>);<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-35"></a>
злоумышленником передается конструкция, содержащая точку с&nbsp;запятой, например <strong>12;INSERT INTO admin (username, password) VALUES ('HaCkEr', 'foo');</strong> то&nbsp;в одном запросе будут выполнены 2 команды<br /><br /><a name="p-1437-36"></a>
<!--notypo--><div class="code"><code><font color=blue>SELECT</font>&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;news&nbsp;<font color=blue>WHERE</font>&nbsp;id_news&nbsp;=&nbsp;<font color=green><b>12</b></font>;<br />
<font color=blue>INSERT</font>&nbsp;<font color=blue>INTO</font>&nbsp;admin&nbsp;(username,&nbsp;<font color=blue>password</font>)&nbsp;<font color=blue>VALUES</font>&nbsp;('HaCkEr',&nbsp;'foo');<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-37"></a>
и&nbsp;в таблицу admin будет несанкционированно добавлена запись <!--notypo-->HaCkEr<!--/notypo-->.<br /><a name="h306-7"></a><h2>2. Методика атак типа внедрение SQL-кода</h2>
<a name="h306-8"></a><h3>2.1. Поиск скриптов, уязвимых для&nbsp;атаки</h3>
<br /><a name="p-1437-38"></a>
На&nbsp;данном этапе злоумышленником изучается поведение скриптов сервера при&nbsp;манипуляции входными параметрами с&nbsp;целью обнаружения их&nbsp;аномального поведения. Манипуляция происходит всеми возможными параметрами:<br /><ul><li> Данными передаваемыми через методы POST и&nbsp;GET
</li><li> Значениями [HTTP-Cookie]
</li><li> HTTP_REFERER (для скриптов )
</li><li> AUTH_USER и&nbsp;AUTH_PASSWORD (при использовании аутентификации)</li></ul>
<br /><a name="p-1437-39"></a>
Как&nbsp;правило, манипуляция сводится к&nbsp;подстановке в&nbsp;параметры символа одинарной (реже двойной или&nbsp;обратной) кавычки.<br /><br /><a name="p-1437-40"></a>
Аномальным поведением считается любое поведение, при&nbsp;котором страницы, получаемые до&nbsp;и после подстановки кавычек, различаются (и при&nbsp;этом не&nbsp;выведена страница о&nbsp;неверном формате параметров).<br /><br /><a name="p-1437-41"></a>
Наиболее частые примеры аномального поведения:<br /><br />
<ul><li> выводится сообщение о&nbsp;различных ошибках;
</li><li> при&nbsp;запросе данных (например, новости или&nbsp;списка продукции) запрашиваемые данные не&nbsp;выводятся вообще, хотя страница отображается</li></ul><a name="p-1437-42"></a>
и&nbsp;т. д. Следует учитывать, что&nbsp;известны случаи, когда сообщения об&nbsp;ошибках, в&nbsp;силу специфики разметки страницы, не&nbsp;отображаются в&nbsp;браузере, хотя и&nbsp;присутствуют в&nbsp;её HTML-коде.<br /><a name="h306-9"></a><h2>3. Защита от&nbsp;атак типа внедрение SQL-кода</h2>
<br /><a name="p-1437-43"></a>
Для&nbsp;защиты от&nbsp;данного типа атак необходимо тщательно фильтровать входные параметры, значения которых будут использованы для&nbsp;построения SQL-запроса.<br /><a name="h306-10"></a><h3>3.1. Фильтрация строковых параметров</h3>
<br /><a name="p-1437-44"></a>
Предположим, что&nbsp;код, генерирующий запрос (на языке программирования Паскаль), выглядит так:<br /><br /><a name="p-1437-45"></a>
<!--notypo--><textarea class="code" rows="2" readonly="readonly">statement := 'SELECT * FROM users WHERE name = &quot;' + userName + '&quot;;';</textarea><!--/notypo--><br /><br /><a name="p-1437-46"></a>
Чтобы внедрение кода было невозможно, требуется брать в&nbsp;кавычки все&nbsp;строковые параметры. В&nbsp;само&#769;м параметре заменяют кавычки на&nbsp;\", апостроф на&nbsp;\', обратную косую черту на&nbsp;\\ (это называется «экранировать спецсимволы»). Это&nbsp;можно делать таким кодом:<br /><br /><a name="p-1437-47"></a>
<!--notypo--><textarea class="code" rows="2" readonly="readonly">statement := 'SELECT * FROM users WHERE name = ' + QuoteParam(userName) + ';';</textarea><!--/notypo--><br /><br /><a name="p-1437-48"></a>
<!--notypo--><textarea class="code" rows="15" readonly="readonly">function QuoteParam(s : string) : string;
{ на входе — строка; на выходе — строка в кавычках и с заменёнными спецсимволами }
var
  i : integer;
  Dest : string;
begin
  Dest := '&quot;';
  for i:=1 to length(s) do
    case s[i] of
      '''' : Dest := Dest + '\''';
      '&quot;' : Dest := Dest + '\&quot;';
      '\' : Dest := Dest + '\\';
    else Dest := Dest + s[i];
    end; 
  QuoteParam := Dest + '&quot;';
end;</textarea><!--/notypo--><br /><br /><a name="p-1437-49"></a>
Для&nbsp;PHP фильтрация может быть такой:<br /><br /><a name="p-1437-50"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?<br />$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;user='"</span><span style="color: #007700">.</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">).</span><span style="color: #DD0000">"';"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div><!--/notypo--><br /><a name="h306-11"></a><h3>3.2. Фильтрация целочисленных параметров</h3>
<br /><a name="p-1437-51"></a>
Возьмём другой запрос:<br /><br /><a name="p-1437-52"></a>
<!--notypo--><div class="code"><code>statement&nbsp;:=&nbsp;'SELECT&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;users&nbsp;<font color=blue>WHERE</font>&nbsp;id&nbsp;=&nbsp;'&nbsp;+&nbsp;id&nbsp;+&nbsp;';';<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-53"></a>
В&nbsp;данном случае поле id&nbsp;имеет числовой тип, и&nbsp;его нельзя брать в&nbsp;кавычки. Поэтому «закавычивание» и&nbsp;замена спецсимволов на&nbsp;escape-последовательности не&nbsp;проходит. В&nbsp;таком случае помогает проверка типа; если переменная id&nbsp;не является числом, запрос вообще не&nbsp;должен выполняться.<br />
Например, на&nbsp;Delphi для&nbsp;противодействия таким инъекциям помогает код:<br />
<!--notypo--><div class="code"><code>id_int&nbsp;:=&nbsp;StrToInt(id);<br />
&nbsp;statement&nbsp;:=&nbsp;'SELECT&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;users&nbsp;<font color=blue>WHERE</font>&nbsp;id&nbsp;=&nbsp;'&nbsp;+&nbsp;IntToStr(id_int)&nbsp;+&nbsp;';';<font color=green><b></b></font></code></div><!--/notypo--><br /><br /><a name="p-1437-54"></a>
В&nbsp;случае ошибки функция <!--notypo-->StrToInt<!--/notypo--> вызовет исключение <!--notypo-->EConvertError<!--/notypo-->, и&nbsp;в его&nbsp;обработчике можно будет вывести сообщение об&nbsp;ошибке. Двойное преобразование обеспечивает корректную реакцию на&nbsp;числа в&nbsp;формате $132AB (шестнадцатеричная система счисления). На&nbsp;стандартном Паскале, не&nbsp;умеющем обрабатывать исключения, код&nbsp;несколько сложнее.<br />
Для&nbsp;PHP этот метод будет выглядеть так:<br /><br /><a name="p-1437-55"></a>
<!--notypo--><div class="code"><code><span style="color: #000000">
$query&nbsp;=&nbsp;'SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;id&nbsp;=&nbsp;'&nbsp;.&nbsp;intval($id);</span>
</code></div><!--/notypo--><br /><a name="h306-12"></a><h3>3.3. Усечение входных параметров</h3>
<br /><a name="p-1437-56"></a>
Для&nbsp;внесения изменений в&nbsp;логику выполнения SQL-запроса требуется внедрение достаточно длинных строк. Так, минимальная длина внедряемой строки в&nbsp;вышеприведённых примерах составляет 9 символов (&laquo;<strong>-1 OR&nbsp;1=1</strong>&raquo;). Если максимальная длина корректного значения параметра невелика, то&nbsp;одним из&nbsp;методов защиты может быть максимальное усечение значений входных параметров.<br />
Например, если известно, что&nbsp;поле id&nbsp;в вышеприведённых примерах может принимать значения не&nbsp;более 9999, можно «отрезать лишние» символы, оставив не&nbsp;более четырёх:<br />
<!--notypo--><div class="code"><code>statement&nbsp;:=&nbsp;'SELECT&nbsp;*&nbsp;<font color=blue>FROM</font>&nbsp;users&nbsp;<font color=blue>WHERE</font>&nbsp;id&nbsp;=&nbsp;'&nbsp;+&nbsp;LeftStr(id,&nbsp;<font color=green><b>4</b></font>)&nbsp;+&nbsp;';';<font color=green><b></b></font></code></div><!--/notypo--><br /><a name="h306-13"></a><h3>3.4. Использование параметризованных запросов</h3>
<br /><a name="p-1437-57"></a>
Многие сервера баз&nbsp;данных поддерживают возможность отправки параметризованных запросов. При&nbsp;этом параметры внешнего происхождения отправляются на&nbsp;сервер отдельно от&nbsp;самого запроса либо автоматически экранируются клиентской библиотекой. Для&nbsp;этого используются<br />
<strong></strong>на Delphi — свойство TQuery.Params;<br /><br /><a name="p-1437-58"></a>
Например<br />
<!--notypo--><textarea class="code" rows="11" readonly="readonly">var
  sql, param : string;
begin
  sql := 'select :text as value from dual';
  param := 'alpha';  
  Query1.Sql.Text := sql;
  Query1.ParamByName('text').AsString := param;
  Query1.Open;
  ShowMessage(Query1['value']);  
end;</textarea><!--/notypo--><br /><br /><a name="p-1437-59"></a>
<!--notypo-->на Perl — через DBI::quote или DBI::prepare;<!--/notypo--><br />
<!--notypo-->на Java — через класс PreparedStatement;<!--/notypo--><br />
<!--notypo-->на C# — свойство SqlCommand.Parameters;<!--/notypo--><br />
<!--notypo-->на PHP (при работе с MySQL) — функции mysql_escape_string, mysql_real_escape_string, addslashes.<!--/notypo--><br />
<!--notypo-->на Parser — язык сам предотвращает атаки подобного рода.<!--/notypo--><br />   <script language="JavaScript" type="text/javascript">
   var dbclick = "page";
  </script>
<br style="clear:both" />&nbsp;
</div>

           


<br><br><br><br><br><br></div></div></div>

<div class="container">
                      <div class="bubble">
                        <div class="info">

<h2>Литература</h2>

<p align="center"><a class="button1" href="http://www.mysql.ru/docs/man/" target="_blank"><strong>Справочник MySQL</strong></a></p>
                
                <p align="center"><a class="button1" href="http://www.intuit.ru/studies/courses/111/111/info" target="_blank"><strong>Курсы MySQL</strong></a></p>

<br><br><br><br><br><br></div></div></div>
<a href="#" title="Вернуться к началу" class="topbutton">Наверх</a> 

      
     
    <br><br><br><br><br><br><br><br><br><br><br><br><br><br></body>
                <footer class="footer" align="center"><br><input  type="text" id="text-to-find" value=""> 
<input   type="button" onclick="javascript: FindOnPage('text-to-find'); return false;" value="Найти"/><br><br>
	           Restart72 &copy;2017 Дмитрий Сидоров (Казанцев) | Open Source Project ||| Материалы взяты с сайта <a href="https://html5book.ru">HTML5BOOK.RU</a>
	           
        </footer>
    </head>
</html>


